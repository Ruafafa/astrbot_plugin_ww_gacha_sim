<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>卡池配置管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .banner-card {
            transition: transform 0.2s;
        }
        .banner-card:hover {
            transform: translateY(-5px);
        }
        .probability-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .item-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
        }
        .form-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">卡池配置管理</h1>
        
        <!-- Banner List Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <h3>现有卡池列表</h3>
                    <button id="newBannerBtn" class="btn btn-primary">创建新配置</button>
                </div>
                
                <div id="bannerList" class="row">
                    <!-- Banner cards will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Banner Form Section -->
        <div id="bannerFormSection" class="row" style="display: none;">
            <div class="col-12">
                <div class="form-section">
                    <h3 id="formTitle">创建新卡池</h3>
                    <form id="bannerForm">
                        <input type="hidden" id="bannerId">
                        
                        <!-- Basic Information -->
                        <div class="mb-3">
                            <label for="bannerName" class="form-label">卡池名称</label>
                            <input type="text" class="form-control" id="bannerName" required>
                        </div>
                        
                        <!-- Probability Settings -->
                        <div class="mb-3">
                            <h4>概率设置</h4>
                            <div class="probability-section">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="base5StarRate" class="form-label">基础5星概率: <span id="base5StarRateDisplay">0.008</span></label>
                                    <input type="range" class="form-range" id="base5StarRateSlider" min="0" max="1" step="0.001" value="0.008">
                                    <input type="number" class="form-control mt-2" id="base5StarRate" step="0.001" min="0" max="1" required>
                                    <div class="form-text">默认: 0.008 (0.8%)</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="base4StarRate" class="form-label">基础4星概率: <span id="base4StarRateDisplay">0.06</span></label>
                                    <input type="range" class="form-range" id="base4StarRateSlider" min="0" max="1" step="0.001" value="0.06">
                                    <input type="number" class="form-control mt-2" id="base4StarRate" step="0.001" min="0" max="1" required>
                                    <div class="form-text">默认: 0.06 (6%)</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label for="base3StarRate" class="form-label">基础3星概率 (自动计算): <span id="base3StarRateDisplay">0.932</span></label>
                                    <input type="number" class="form-control" id="base3StarRate" step="0.001" min="0" max="1" readonly>
                                    <div class="form-text">此值将自动计算为 1 - 5星概率 - 4星概率</div>
                                </div>
                            </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="up5StarRate" class="form-label">5星UP概率</label>
                                        <input type="number" class="form-control" id="up5StarRate" step="0.01" min="0" max="1" required>
                                        <div class="form-text">默认: 0.5 (50%)</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="up4StarRate" class="form-label">4星UP概率</label>
                                        <input type="number" class="form-control" id="up4StarRate" step="0.01" min="0" max="1" required>
                                        <div class="form-text">默认: 0.5 (50%)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Included Items -->
                        <div class="mb-3">
                            <h4>包含物品设置</h4>
                            <div class="row">
                                <!-- 5星包含物品 -->
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">5星包含物品</label>
                                    <div class="position-relative">
                                        <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="included5StarSearch" placeholder="搜索/选择5星物品...">
                                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="included5StarDropdownBtn" aria-expanded="false">选择</button>
                                        </div>
                                        <ul class="dropdown-menu" id="included5StarDropdown" style="top: 100%; right: 0; left: auto; position: absolute; max-height: 200px; overflow-y: auto;">
                                            <!-- 5星物品选项将动态加载到这里 -->
                                        </ul>
                                    </div>
                                    <div class="d-flex gap-2 mb-2">
                                        <button type="button" class="btn btn-sm btn-primary" id="selectAll5Star">全选</button>
                                        <button type="button" class="btn btn-sm btn-danger" id="clearAll5Star">清空</button>
                                    </div>
                                    <label for="selected5StarIncludedDisplay" class="form-label">已选5星包含物品</label>
                                    <div class="border rounded p-2" id="selected5StarIncludedDisplay" style="min-height: 50px; background-color: #f8f9fa; max-height: 100px; overflow-y: auto;">
                                        <span class="text-muted">暂无物品</span>
                                    </div>
                                    <input type="hidden" id="included5StarItems">
                                </div>
                                <!-- 4星包含物品 -->
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">4星包含物品</label>
                                    <div class="position-relative">
                                        <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="included4StarSearch" placeholder="搜索/选择4星物品...">
                                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="included4StarDropdownBtn" aria-expanded="false">选择</button>
                                        </div>
                                        <ul class="dropdown-menu" id="included4StarDropdown" style="top: 100%; right: 0; left: auto; position: absolute; max-height: 200px; overflow-y: auto;">
                                            <!-- 4星物品选项将动态加载到这里 -->
                                        </ul>
                                    </div>
                                    <div class="d-flex gap-2 mb-2">
                                        <button type="button" class="btn btn-sm btn-primary" id="selectAll4Star">全选</button>
                                        <button type="button" class="btn btn-sm btn-danger" id="clearAll4Star">清空</button>
                                    </div>
                                    <label for="selected4StarIncludedDisplay" class="form-label">已选4星包含物品</label>
                                    <div class="border rounded p-2" id="selected4StarIncludedDisplay" style="min-height: 50px; background-color: #f8f9fa; max-height: 100px; overflow-y: auto;">
                                        <span class="text-muted">暂无物品</span>
                                    </div>
                                    <input type="hidden" id="included4StarItems">
                                </div>
                                <!-- 3星包含物品 -->
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">3星包含物品</label>
                                    <div class="position-relative">
                                        <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="included3StarSearch" placeholder="搜索/选择3星物品...">
                                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="included3StarDropdownBtn" aria-expanded="false">选择</button>
                                        </div>
                                        <ul class="dropdown-menu" id="included3StarDropdown" style="top: 100%; right: 0; left: auto; position: absolute; max-height: 200px; overflow-y: auto;">
                                            <!-- 3星物品选项将动态加载到这里 -->
                                        </ul>
                                    </div>
                                    <div class="d-flex gap-2 mb-2">
                                        <button type="button" class="btn btn-sm btn-primary" id="selectAll3Star">全选</button>
                                        <button type="button" class="btn btn-sm btn-danger" id="clearAll3Star">清空</button>
                                    </div>
                                    <label for="selected3StarIncludedDisplay" class="form-label">已选3星包含物品</label>
                                    <div class="border rounded p-2" id="selected3StarIncludedDisplay" style="min-height: 50px; background-color: #f8f9fa; max-height: 100px; overflow-y: auto;">
                                        <span class="text-muted">暂无物品</span>
                                    </div>
                                    <input type="hidden" id="included3StarItems">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Rate Up Items -->
                        <div class="mb-3">
                            <h4>UP物品设置</h4>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">5星UP物品</label>
                                    <div class="position-relative">
                                        <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="up5StarSearch" placeholder="搜索/选择5星物品...">
                                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="up5StarDropdownBtn" aria-expanded="false">选择</button>
                                        </div>
                                        <ul class="dropdown-menu" id="up5StarDropdown" style="top: 100%; right: 0; left: auto; position: absolute; max-height: 300px; overflow-y: auto;">
                                            <!-- 5星物品选项将动态加载到这里 -->
                                        </ul>
                                    </div>
                                    <label for="selected5StarItemsDisplay" class="form-label">已选5星UP物品</label>
                                    <div class="border rounded p-2" id="selected5StarItemsDisplay" style="min-height: 50px; background-color: #f8f9fa;">
                                        <span class="text-muted">暂无物品</span>
                                    </div>
                                    <input type="hidden" id="up5StarItems">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">4星UP物品</label>
                                    <div class="position-relative">
                                        <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="up4StarSearch" placeholder="搜索/选择4星物品...">
                                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="up4StarDropdownBtn" aria-expanded="false">选择</button>
                                        </div>
                                        <ul class="dropdown-menu" id="up4StarDropdown" style="top: 100%; right: 0; left: auto; position: absolute; max-height: 300px; overflow-y: auto;">
                                            <!-- 4星物品选项将动态加载到这里 -->
                                        </ul>
                                    </div>
                                    <label for="selected4StarItemsDisplay" class="form-label">已选4星UP物品</label>
                                    <div class="border rounded p-2" id="selected4StarItemsDisplay" style="min-height: 50px; background-color: #f8f9fa;">
                                        <span class="text-muted">暂无物品</span>
                                    </div>
                                    <input type="hidden" id="up4StarItems">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Probability Progression (5-star pity system) -->
                        <div class="mb-3">
                            <h4>概率递增设置 (5星保底)</h4>
                            <div class="probability-section">
                                <h5>软保底设置</h5>
                                <div id="softPityContainer">
                                    <!-- Soft pity entries will be added here -->
                                </div>
                                <button type="button" id="addSoftPityBtn" class="btn btn-secondary btn-sm mt-2">添加软保底区间</button>
                                
                                <div class="row mt-3">
                                    <div class="col-md-6 mb-3">
                                        <label for="hardPityPull" class="form-label">硬保底抽数</label>
                                        <input type="number" class="form-control" id="hardPityPull" min="1" required>
                                        <div class="form-text">默认: 80</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="hardPityRate" class="form-label">硬保底概率</label>
                                        <input type="number" class="form-control" id="hardPityRate" step="0.01" min="0" max="1" required>
                                        <div class="form-text">默认: 1 (100%)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Form Actions -->
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-success">保存配置</button>
                            <button type="button" id="cancelFormBtn" class="btn btn-secondary">取消</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Modal for deletion confirmation -->
        <div class="modal fade" id="deleteModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">确认删除</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>您确定要删除 Banner "<span id="bannerToDeleteName"></span>" 吗？此操作不可撤销。</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">确认删除</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
import{T as re,ae as ne,aC as ue,v as n,M as ce,o as _,g as b,A as r,t as d,f as i,b as a,B as m,w as o,e as c,E as me,F as $,h as E,a as ve,l as K,Q as T,y as D,z as U,I as S,a3 as y,C as M,a4 as pe,a5 as _e,aZ as fe,D as Q,V as W,af as Z,ag as O,H as R,J as N,G as be,ak as ke,K as w,R as ge,S as he}from"./index-61371d60.js";import{_ as ye}from"./_plugin-vue_export-helper-c27b6911.js";const xe=C=>(ge("data-v-97eca901"),C=C(),he(),C),Ve={class:"kb-list-page"},we={class:"page-header"},Ce={class:"text-h4 mb-2"},je={class:"text-subtitle-1 text-medium-emphasis"},Fe={class:"action-bar mb-6"},Be={key:0,class:"loading-container"},De={class:"mt-4 text-medium-emphasis"},Se={key:1,class:"kb-grid"},Pe={class:"kb-card-content"},Le={class:"kb-emoji"},ze={class:"kb-name"},Ie={class:"kb-description text-medium-emphasis"},$e={class:"kb-stats mt-4"},Ee={class:"stat-item"},Ke={class:"stat-item"},Te={class:"kb-actions"},Ue={key:2,class:"empty-state"},Me={class:"mt-4"},Re={class:"text-h5"},Ne={class:"text-center mb-6"},Ae={class:"text-caption text-medium-emphasis mt-2"},qe={class:"text-subtitle-2 mb-2"},Ge={class:"emoji-grid"},He=["onClick"],Je={class:"position-absolute",style:{bottom:"0px",right:"16px"}},Qe=xe(()=>r("a",{style:{"text-decoration":"underline",cursor:"pointer"}},"åˆ‡æ¢åˆ°æ—§ç‰ˆçŸ¥è¯†åº“",-1)),We=[Qe],Ze=re({__name:"KBList",setup(C){const{tm:t}=ne("features/knowledge-base/index"),A=ue(),j=n(!1),P=n(!1),L=n(!1),F=n([]),q=n([]),G=n([]),H=n(null),X=n(!1);n(!1);const Y=n(null),g=n(!1),x=n(!1),V=n(!1),k=n({show:!1,text:"",color:"success"}),z=n(),p=n(null),h=n(null),u=n({kb_name:"",description:"",emoji:"ðŸ“š",embedding_provider_id:null,rerank_provider_id:null}),ee=[{key:"books",emojis:["ðŸ“š","ðŸ“–","ðŸ“•","ðŸ“—","ðŸ“˜","ðŸ“™","ðŸ““","ðŸ“”","ðŸ“’","ðŸ“‘","ðŸ—‚ï¸","ðŸ“‚","ðŸ“","ðŸ—ƒï¸","ðŸ—„ï¸"]},{key:"emotions",emojis:["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ¤£","ðŸ˜‚","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Š","ðŸ˜‡","ðŸ¥°","ðŸ˜"]},{key:"objects",emojis:["ðŸ’¡","ðŸ”¬","ðŸ”­","ðŸ—¿","ðŸ†","ðŸŽ¯","ðŸŽ“","ðŸ”‘","ðŸ”’","ðŸ”“","ðŸ””","ðŸ”•","ðŸ”¨","ðŸ› ï¸","âš™ï¸"]},{key:"symbols",emojis:["â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ–¤","ðŸ¤","ðŸ¤Ž","â­","ðŸŒŸ","âœ¨","ðŸ’«","âš¡","ðŸ”¥"]}],B=async(s=!1)=>{j.value=!0;try{const l={};s&&(l.refresh_stats="true");const e=await w.get("/api/kb/list",{params:l});e.data.status==="ok"?F.value=e.data.data.items||[]:f(e.data.message||t("messages.loadError"),"error")}catch(l){console.error("Failed to load knowledge bases:",l),f(t("messages.loadError"),"error")}finally{j.value=!1}},ae=async()=>{try{const s=await w.get("/api/config/provider/list",{params:{provider_type:"embedding,rerank"}});s.data.status==="ok"&&(q.value=s.data.data.filter(l=>l.provider_type==="embedding"),G.value=s.data.data.filter(l=>l.provider_type==="rerank"))}catch(s){console.error("Failed to load providers:",s)}},te=s=>{A.push({name:"NativeKBDetail",params:{kbId:s}})},le=s=>{p.value=s,H.value=s.embedding_provider_id,u.value={kb_name:s.kb_name,description:s.description||"",emoji:s.emoji||"ðŸ“š",embedding_provider_id:s.embedding_provider_id,rerank_provider_id:s.rerank_provider_id},g.value=!0},se=s=>{h.value=s,V.value=!0},oe=()=>{V.value=!1,h.value=null},ie=async()=>{if(h.value){L.value=!0;try{const s=await w.post("/api/kb/delete",{kb_id:h.value.kb_id});console.log("Delete response:",s.data),s.data.status==="ok"?(f(t("messages.deleteSuccess")),await B(),V.value=!1,h.value=null):f(s.data.message||t("messages.deleteFailed"),"error")}catch(s){console.error("Failed to delete knowledge base:",s),f(t("messages.deleteFailed"),"error")}finally{L.value=!1}}},J=async()=>{const{valid:s}=await z.value.validate();if(s){P.value=!0;try{const l={kb_name:u.value.kb_name,description:u.value.description,emoji:u.value.emoji,embedding_provider_id:u.value.embedding_provider_id,rerank_provider_id:u.value.rerank_provider_id};let e;p.value?e=await w.post("/api/kb/update",{kb_id:p.value.kb_id,...l}):e=await w.post("/api/kb/create",l),e.data.status==="ok"?(f(p.value?t("messages.updateSuccess"):t("messages.createSuccess")),I(),await B()):f(e.data.message||(p.value?t("messages.updateFailed"):t("messages.createFailed")),"error")}catch(l){console.error("Failed to save knowledge base:",l),f(p.value?t("messages.updateFailed"):t("messages.createFailed"),"error")}finally{P.value=!1}}},I=()=>{var s;g.value=!1,p.value=null,H.value=null,X.value=!1,Y.value=null,u.value={kb_name:"",description:"",emoji:"ðŸ“š",embedding_provider_id:null,rerank_provider_id:null},(s=z.value)==null||s.reset()},de=s=>{u.value.emoji=s,x.value=!1},f=(s,l="success")=>{k.value.text=s,k.value.color=l,k.value.show=!0};return ce(()=>{B(!0),ae()}),(s,l)=>(_(),b("div",Ve,[r("div",we,[r("div",null,[r("h1",Ce,d(i(t)("list.title")),1),r("p",je,d(i(t)("list.subtitle")),1)]),a(m,{icon:"mdi-information-outline",variant:"text",size:"small",color:"grey",href:"https://astrbot.app/use/knowledge-base.html",target:"_blank"})]),r("div",Fe,[a(m,{"prepend-icon":"mdi-plus",color:"primary",variant:"elevated",onClick:l[0]||(l[0]=e=>g.value=!0)},{default:o(()=>[c(d(i(t)("list.create")),1)]),_:1}),a(m,{"prepend-icon":"mdi-refresh",variant:"tonal",onClick:B,loading:j.value},{default:o(()=>[c(d(i(t)("list.refresh")),1)]),_:1},8,["loading"])]),j.value&&F.value.length===0?(_(),b("div",Be,[a(me,{indeterminate:"",color:"primary",size:"64"}),r("p",De,d(i(t)("list.loading")),1)])):F.value.length>0?(_(),b("div",Se,[(_(!0),b($,null,E(F.value,e=>(_(),ve(D,{key:e.kb_id,class:"kb-card",elevation:"2",hover:"",onClick:v=>te(e.kb_id)},{default:o(()=>[r("div",Pe,[r("div",Le,d(e.emoji||"ðŸ“š"),1),r("h3",ze,d(e.kb_name),1),r("p",Ie,d(e.description||"æš‚æ— æè¿°"),1),r("div",$e,[r("div",Ee,[a(K,{size:"small",color:"primary"},{default:o(()=>[c("mdi-file-document")]),_:1}),r("span",null,d(e.doc_count||0)+" "+d(i(t)("list.documents")),1)]),r("div",Ke,[a(K,{size:"small",color:"secondary"},{default:o(()=>[c("mdi-text-box")]),_:1}),r("span",null,d(e.chunk_count||0)+" "+d(i(t)("list.chunks")),1)])]),r("div",Te,[a(m,{icon:"mdi-pencil",size:"small",variant:"text",color:"info",onClick:T(v=>le(e),["stop"])},null,8,["onClick"]),a(m,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:T(v=>se(e),["stop"])},null,8,["onClick"])])])]),_:2},1032,["onClick"]))),128))])):(_(),b("div",Ue,[a(K,{size:"100",color:"grey-lighten-2"},{default:o(()=>[c("mdi-book-open-variant")]),_:1}),r("h2",Me,d(i(t)("list.empty")),1),a(m,{class:"mt-6","prepend-icon":"mdi-plus",color:"primary",variant:"elevated",size:"large",onClick:l[1]||(l[1]=e=>g.value=!0)},{default:o(()=>[c(d(i(t)("list.create")),1)]),_:1})])),a(N,{modelValue:g.value,"onUpdate:modelValue":l[7]||(l[7]=e=>g.value=e),"max-width":"600px",persistent:""},{default:o(()=>[a(D,null,{default:o(()=>[a(U,{class:"d-flex align-center"},{default:o(()=>[r("span",Re,d(p.value?i(t)("edit.title"):i(t)("create.title")),1),a(S),a(m,{icon:"mdi-close",variant:"text",onClick:I})]),_:1}),a(y),a(M,{class:"pa-6"},{default:o(()=>[r("div",Ne,[r("div",{class:"emoji-display",onClick:l[2]||(l[2]=e=>x.value=!0)},d(u.value.emoji),1),r("p",Ae,d(i(t)("create.emojiLabel")),1)]),a(pe,{ref_key:"formRef",ref:z,onSubmit:T(J,["prevent"])},{default:o(()=>[a(_e,{modelValue:u.value.kb_name,"onUpdate:modelValue":l[3]||(l[3]=e=>u.value.kb_name=e),label:i(t)("create.nameLabel"),placeholder:i(t)("create.namePlaceholder"),variant:"outlined",rules:[e=>!!e||i(t)("create.nameRequired")],required:"",class:"mb-4",hint:"åŽç»­å¦‚ä¿®æ”¹çŸ¥è¯†åº“åç§°ï¼Œéœ€é‡æ–°åœ¨é…ç½®æ–‡ä»¶æ›´æ–°ã€‚","persistent-hint":""},null,8,["modelValue","label","placeholder","rules"]),a(fe,{modelValue:u.value.description,"onUpdate:modelValue":l[4]||(l[4]=e=>u.value.description=e),label:i(t)("create.descriptionLabel"),placeholder:i(t)("create.descriptionPlaceholder"),variant:"outlined",rows:"3",class:"mb-4"},null,8,["modelValue","label","placeholder"]),a(Q,{modelValue:u.value.embedding_provider_id,"onUpdate:modelValue":l[5]||(l[5]=e=>u.value.embedding_provider_id=e),items:q.value,"item-title":e=>e.embedding_model||e.id,"item-value":"id",label:i(t)("create.embeddingModelLabel"),variant:"outlined",class:"mb-4",disabled:p.value!==null,hint:"åµŒå…¥æ¨¡åž‹é€‰æ‹©åŽæ— æ³•ä¿®æ”¹ï¼Œå¦‚éœ€æ›´æ¢è¯·åˆ›å»ºæ–°çš„çŸ¥è¯†åº“ã€‚","persistent-hint":""},{item:o(({props:e,item:v})=>[a(W,Z(O(e)),{subtitle:o(()=>[c(d(i(t)("create.providerInfo",{id:v.raw.id,dimensions:v.raw.embedding_dimensions||"N/A"})),1)]),_:2},1040)]),_:1},8,["modelValue","items","item-title","label","disabled"]),a(Q,{modelValue:u.value.rerank_provider_id,"onUpdate:modelValue":l[6]||(l[6]=e=>u.value.rerank_provider_id=e),items:G.value,"item-title":e=>e.rerank_model||e.id,"item-value":"id",label:i(t)("create.rerankModelLabel"),variant:"outlined",clearable:"",class:"mb-2"},{item:o(({props:e,item:v})=>[a(W,Z(O(e)),{subtitle:o(()=>[c(d(i(t)("create.rerankProviderInfo",{id:v.raw.id})),1)]),_:2},1040)]),_:1},8,["modelValue","items","item-title","label"])]),_:1},8,["onSubmit"])]),_:1}),a(y),a(R,{class:"pa-4"},{default:o(()=>[a(S),a(m,{variant:"text",onClick:I},{default:o(()=>[c(d(i(t)("create.cancel")),1)]),_:1}),a(m,{color:"primary",variant:"elevated",onClick:J,loading:P.value},{default:o(()=>[c(d(p.value?i(t)("edit.submit"):i(t)("create.submit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:x.value,"onUpdate:modelValue":l[9]||(l[9]=e=>x.value=e),"max-width":"500px"},{default:o(()=>[a(D,null,{default:o(()=>[a(U,{class:"pa-4"},{default:o(()=>[c(d(i(t)("emoji.title")),1)]),_:1}),a(y),a(M,{class:"pa-4"},{default:o(()=>[(_(),b($,null,E(ee,e=>r("div",{key:e.key,class:"mb-4"},[r("p",qe,d(i(t)(`emoji.categories.${e.key}`)),1),r("div",Ge,[(_(!0),b($,null,E(e.emojis,v=>(_(),b("div",{key:v,class:"emoji-item",onClick:Oe=>de(v)},d(v),9,He))),128))])])),64))]),_:1}),a(y),a(R,{class:"pa-4"},{default:o(()=>[a(S),a(m,{variant:"text",onClick:l[8]||(l[8]=e=>x.value=!1)},{default:o(()=>[c(d(i(t)("emoji.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:V.value,"onUpdate:modelValue":l[10]||(l[10]=e=>V.value=e),"max-width":"450px",persistent:""},{default:o(()=>[a(D,null,{default:o(()=>[a(U,{class:"pa-4 text-h6"},{default:o(()=>[c(d(i(t)("delete.title")),1)]),_:1}),a(y),a(M,{class:"pa-6"},{default:o(()=>{var e;return[r("p",null,d(i(t)("delete.confirmText",{name:((e=h.value)==null?void 0:e.kb_name)||""})),1),a(be,{type:"error",variant:"tonal",density:"compact",class:"mt-4"},{default:o(()=>[c(d(i(t)("delete.warning")),1)]),_:1})]}),_:1}),a(y),a(R,{class:"pa-4"},{default:o(()=>[a(S),a(m,{variant:"text",onClick:oe},{default:o(()=>[c(d(i(t)("delete.cancel")),1)]),_:1}),a(m,{color:"error",variant:"elevated",onClick:ie,loading:L.value},{default:o(()=>[c(d(i(t)("delete.confirm")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ke,{modelValue:k.value.show,"onUpdate:modelValue":l[11]||(l[11]=e=>k.value.show=e),color:k.value.color},{default:o(()=>[c(d(k.value.text),1)]),_:1},8,["modelValue","color"]),r("div",Je,[r("small",{onClick:l[12]||(l[12]=e=>i(A).push("/alkaid/knowledge-base"))},We)])]))}});const ea=ye(Ze,[["__scopeId","data-v-97eca901"]]);export{ea as default};

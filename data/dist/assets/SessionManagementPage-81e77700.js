import{u as A,ae as B,K as _,g as b,b as s,w as a,_ as j,o as f,y,z as x,A as m,t as r,B as g,k as v,e as d,al as V,a5 as P,a as k,p,a3 as M,C as E,aU as F,Q as W,l as C,ap as N,m as G,J as R,I as w,G as q,aV as H,H as T,am as h,ao as S,D as U,F as J,h as X,ak as Y,aq as Z,R as $,S as ee}from"./index-61371d60.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";const le={name:"SessionManagementPage",setup(){const{t:o}=A(),{tm:t}=B("features/session-management");return{t:o,tm:t}},data(){return{loading:!1,saving:!1,deleting:!1,loadingUmos:!1,rulesList:[],searchQuery:"",currentPage:1,itemsPerPage:10,totalItems:0,searchTimeout:null,availablePersonas:[],availableChatProviders:[],availableSttProviders:[],availableTtsProviders:[],availablePlugins:[],availableKbs:[],addRuleDialog:!1,availableUmos:[],selectedNewUmo:null,ruleDialog:!1,selectedUmo:null,editingRules:{},serviceConfig:{session_enabled:!0,llm_enabled:!0,tts_enabled:!0,custom_name:"",persona_id:null},providerConfig:{chat_completion:null,speech_to_text:null,text_to_speech:null},pluginConfig:{enabled_plugins:[],disabled_plugins:[]},kbConfig:{kb_ids:[],top_k:5,enable_rerank:!0},deleteDialog:!1,deleteTarget:null,selectedItems:[],batchDeleteDialog:!1,quickEditNameDialog:!1,quickEditNameTarget:null,quickEditNameValue:"",snackbar:!1,snackbarText:"",snackbarColor:"success"}},computed:{headers(){return[{title:this.tm("table.headers.umoInfo"),key:"umo_info",sortable:!1,minWidth:"300px"},{title:this.tm("table.headers.rulesOverview"),key:"rules_overview",sortable:!1,minWidth:"250px"},{title:this.tm("table.headers.actions"),key:"actions",sortable:!1,minWidth:"150px"}]},filteredRulesList(){return this.rulesList},personaOptions(){return[{label:this.tm("persona.none"),value:null},...this.availablePersonas.map(o=>({label:o.name,value:o.name}))]},chatProviderOptions(){return[{label:this.tm("provider.followConfig"),value:null},...this.availableChatProviders.map(o=>({label:`${o.name} (${o.model})`,value:o.id}))]},sttProviderOptions(){return[{label:this.tm("provider.followConfig"),value:null},...this.availableSttProviders.map(o=>({label:`${o.name} (${o.model})`,value:o.id}))]},ttsProviderOptions(){return[{label:this.tm("provider.followConfig"),value:null},...this.availableTtsProviders.map(o=>({label:`${o.name} (${o.model})`,value:o.id}))]},pluginOptions(){return this.availablePlugins.map(o=>({label:o.display_name||o.name,value:o.name}))},kbOptions(){return this.availableKbs.map(o=>({label:`${o.emoji||"ðŸ“š"} ${o.kb_name}`,value:o.kb_id}))}},watch:{searchQuery:{handler(){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.onSearchChange()},300)}}},mounted(){this.loadData()},beforeUnmount(){this.searchTimeout&&clearTimeout(this.searchTimeout)},methods:{async loadData(){var o,t;this.loading=!0;try{const n=await _.get("/api/session/list-rule",{params:{page:this.currentPage,page_size:this.itemsPerPage,search:this.searchQuery||""}});if(n.data.status==="ok"){const l=n.data.data;this.rulesList=l.rules,this.totalItems=l.total,this.availablePersonas=l.available_personas,this.availableChatProviders=l.available_chat_providers,this.availableSttProviders=l.available_stt_providers,this.availableTtsProviders=l.available_tts_providers,this.availablePlugins=l.available_plugins||[],this.availableKbs=l.available_kbs||[]}else this.showError(n.data.message||this.tm("messages.loadError"))}catch(n){this.showError(((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.message)||this.tm("messages.loadError"))}this.loading=!1},onTableOptionsUpdate(o){this.currentPage=o.page,this.itemsPerPage=o.itemsPerPage,this.loadData()},onSearchChange(){this.currentPage=1,this.loadData()},async loadUmos(){var o,t;this.loadingUmos=!0;try{const n=await _.get("/api/session/active-umos");if(n.data.status==="ok"){const l=new Set(this.rulesList.map(e=>e.umo));this.availableUmos=n.data.data.umos.filter(e=>!l.has(e))}}catch(n){this.showError(((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.message)||this.tm("messages.loadError"))}this.loadingUmos=!1},async refreshData(){await this.loadData(),this.showSuccess(this.tm("messages.refreshSuccess"))},hasProviderConfig(o){return o&&(o.provider_perf_chat_completion||o.provider_perf_speech_to_text||o.provider_perf_text_to_speech)},async openAddRuleDialog(){this.addRuleDialog=!0,this.selectedNewUmo=null,await this.loadUmos()},createNewRule(){if(!this.selectedNewUmo)return;const o={umo:this.selectedNewUmo,rules:{}},t=this.selectedNewUmo.split(":");t.length>=3&&(o.platform=t[0],o.message_type=t[1],o.session_id=t[2]),this.addRuleDialog=!1,this.openRuleEditor(o)},openRuleEditor(o){this.selectedUmo=o,this.editingRules=o.rules||{};const t=this.editingRules.session_service_config||{};this.serviceConfig={session_enabled:t.session_enabled!==!1,llm_enabled:t.llm_enabled!==!1,tts_enabled:t.tts_enabled!==!1,custom_name:t.custom_name||"",persona_id:t.persona_id||null},this.providerConfig={chat_completion:this.editingRules.provider_perf_chat_completion||null,speech_to_text:this.editingRules.provider_perf_speech_to_text||null,text_to_speech:this.editingRules.provider_perf_text_to_speech||null};const n=this.editingRules.session_plugin_config||{};this.pluginConfig={enabled_plugins:n.enabled_plugins||[],disabled_plugins:n.disabled_plugins||[]};const l=this.editingRules.kb_config||{};this.kbConfig={kb_ids:l.kb_ids||[],top_k:l.top_k??5,enable_rerank:l.enable_rerank!==!1},this.ruleDialog=!0},closeRuleEditor(){this.ruleDialog=!1,this.selectedUmo=null,this.editingRules={}},async saveServiceConfig(){var o,t;if(this.selectedUmo){this.saving=!0;try{const n={...this.serviceConfig};n.custom_name||delete n.custom_name,n.persona_id===null&&delete n.persona_id;const l=await _.post("/api/session/update-rule",{umo:this.selectedUmo.umo,rule_key:"session_service_config",rule_value:n});if(l.data.status==="ok"){this.showSuccess(this.tm("messages.saveSuccess")),this.editingRules.session_service_config=n;let e=this.rulesList.find(u=>u.umo===this.selectedUmo.umo);e?e.rules={...e.rules,session_service_config:n}:this.rulesList.push({umo:this.selectedUmo.umo,platform:this.selectedUmo.platform,message_type:this.selectedUmo.message_type,session_id:this.selectedUmo.session_id,rules:{session_service_config:n}})}else this.showError(l.data.message||this.tm("messages.saveError"))}catch(n){this.showError(((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.message)||this.tm("messages.saveError"))}this.saving=!1}},async saveProviderConfig(){var o,t;if(this.selectedUmo){this.saving=!0;try{const n=[],l=[],e=["chat_completion","speech_to_text","text_to_speech"];for(const i of e){const c=this.providerConfig[i];c?n.push(_.post("/api/session/update-rule",{umo:this.selectedUmo.umo,rule_key:`provider_perf_${i}`,rule_value:c})):this.editingRules[`provider_perf_${i}`]&&l.push(_.post("/api/session/delete-rule",{umo:this.selectedUmo.umo,rule_key:`provider_perf_${i}`}))}const u=[...n,...l];if(u.length>0){await Promise.all(u),this.showSuccess(this.tm("messages.saveSuccess"));let i=this.rulesList.find(c=>c.umo===this.selectedUmo.umo);i||(i={umo:this.selectedUmo.umo,platform:this.selectedUmo.platform,message_type:this.selectedUmo.message_type,session_id:this.selectedUmo.session_id,rules:{}},this.rulesList.push(i));for(const c of e)this.providerConfig[c]?(i.rules[`provider_perf_${c}`]=this.providerConfig[c],this.editingRules[`provider_perf_${c}`]=this.providerConfig[c]):(delete i.rules[`provider_perf_${c}`],delete this.editingRules[`provider_perf_${c}`])}else this.showSuccess(this.tm("messages.noChanges"))}catch(n){this.showError(((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.message)||this.tm("messages.saveError"))}this.saving=!1}},async savePluginConfig(){var o,t;if(this.selectedUmo){this.saving=!0;try{const n={enabled_plugins:this.pluginConfig.enabled_plugins,disabled_plugins:this.pluginConfig.disabled_plugins};if(n.enabled_plugins.length===0&&n.disabled_plugins.length===0){if(this.editingRules.session_plugin_config){await _.post("/api/session/delete-rule",{umo:this.selectedUmo.umo,rule_key:"session_plugin_config"}),delete this.editingRules.session_plugin_config;let l=this.rulesList.find(e=>e.umo===this.selectedUmo.umo);l&&delete l.rules.session_plugin_config}this.showSuccess(this.tm("messages.saveSuccess"))}else{const l=await _.post("/api/session/update-rule",{umo:this.selectedUmo.umo,rule_key:"session_plugin_config",rule_value:n});if(l.data.status==="ok"){this.showSuccess(this.tm("messages.saveSuccess")),this.editingRules.session_plugin_config=n;let e=this.rulesList.find(u=>u.umo===this.selectedUmo.umo);e?e.rules.session_plugin_config=n:this.rulesList.push({umo:this.selectedUmo.umo,platform:this.selectedUmo.platform,message_type:this.selectedUmo.message_type,session_id:this.selectedUmo.session_id,rules:{session_plugin_config:n}})}else this.showError(l.data.message||this.tm("messages.saveError"))}}catch(n){this.showError(((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.message)||this.tm("messages.saveError"))}this.saving=!1}},async saveKbConfig(){var o,t;if(this.selectedUmo){this.saving=!0;try{const n={kb_ids:this.kbConfig.kb_ids,top_k:this.kbConfig.top_k,enable_rerank:this.kbConfig.enable_rerank};if(n.kb_ids.length===0){if(this.editingRules.kb_config){await _.post("/api/session/delete-rule",{umo:this.selectedUmo.umo,rule_key:"kb_config"}),delete this.editingRules.kb_config;let l=this.rulesList.find(e=>e.umo===this.selectedUmo.umo);l&&delete l.rules.kb_config}this.showSuccess(this.tm("messages.saveSuccess"))}else{const l=await _.post("/api/session/update-rule",{umo:this.selectedUmo.umo,rule_key:"kb_config",rule_value:n});if(l.data.status==="ok"){this.showSuccess(this.tm("messages.saveSuccess")),this.editingRules.kb_config=n;let e=this.rulesList.find(u=>u.umo===this.selectedUmo.umo);e?e.rules.kb_config=n:this.rulesList.push({umo:this.selectedUmo.umo,platform:this.selectedUmo.platform,message_type:this.selectedUmo.message_type,session_id:this.selectedUmo.session_id,rules:{kb_config:n}})}else this.showError(l.data.message||this.tm("messages.saveError"))}}catch(n){this.showError(((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.message)||this.tm("messages.saveError"))}this.saving=!1}},confirmDeleteRules(o){this.deleteTarget=o,this.deleteDialog=!0},async deleteAllRules(){var o,t;if(this.deleteTarget){this.deleting=!0;try{const n=await _.post("/api/session/delete-rule",{umo:this.deleteTarget.umo});if(n.data.status==="ok"){this.showSuccess(this.tm("messages.deleteSuccess"));const l=this.rulesList.findIndex(e=>e.umo===this.deleteTarget.umo);l>-1&&this.rulesList.splice(l,1),this.deleteDialog=!1,this.deleteTarget=null,await this.loadData()}else this.showError(n.data.message||this.tm("messages.deleteError"))}catch(n){this.showError(((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.message)||this.tm("messages.deleteError"))}this.deleting=!1}},confirmBatchDelete(){this.selectedItems.length!==0&&(this.batchDeleteDialog=!0)},async batchDeleteRules(){var o,t;if(this.selectedItems.length!==0){this.deleting=!0;try{const n=this.selectedItems.map(e=>e.umo),l=await _.post("/api/session/batch-delete-rule",{umos:n});if(l.data.status==="ok"){const e=l.data.data;this.showSuccess(e.message||this.tm("messages.batchDeleteSuccess")),this.batchDeleteDialog=!1,this.selectedItems=[],await this.loadData()}else this.showError(l.data.message||this.tm("messages.batchDeleteError"))}catch(n){this.showError(((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.message)||this.tm("messages.batchDeleteError"))}this.deleting=!1}},getPlatformColor(o){const t={aiocqhttp:"blue",wechatpadpro:"green",qq_official:"purple",telegram:"light-blue",discord:"indigo",webchat:"orange",default:"grey"};return t[o]||t.default},showSuccess(o){this.snackbarText=o,this.snackbarColor="success",this.snackbar=!0},showError(o){this.snackbarText=o,this.snackbarColor="error",this.snackbar=!0},openQuickEditName(o){var t,n;this.quickEditNameTarget=o,this.quickEditNameValue=((n=(t=o.rules)==null?void 0:t.session_service_config)==null?void 0:n.custom_name)||"",this.quickEditNameDialog=!0},async saveQuickEditName(){var o,t,n;if(this.quickEditNameTarget){this.saving=!0;try{const l=((o=this.quickEditNameTarget.rules)==null?void 0:o.session_service_config)||{},e={session_enabled:l.session_enabled!==!1,llm_enabled:l.llm_enabled!==!1,tts_enabled:l.tts_enabled!==!1,...l};this.quickEditNameValue?e.custom_name=this.quickEditNameValue:delete e.custom_name;const u=await _.post("/api/session/update-rule",{umo:this.quickEditNameTarget.umo,rule_key:"session_service_config",rule_value:e});if(u.data.status==="ok"){this.showSuccess(this.tm("messages.saveSuccess"));let i=this.rulesList.find(c=>c.umo===this.quickEditNameTarget.umo);if(i)i.rules||(i.rules={}),i.rules.session_service_config=e;else{const c=this.quickEditNameTarget.umo.split(":");this.rulesList.push({umo:this.quickEditNameTarget.umo,platform:c[0]||"",message_type:c[1]||"",session_id:c[2]||"",rules:{session_service_config:e}})}this.quickEditNameDialog=!1,this.quickEditNameTarget=null,this.quickEditNameValue=""}else this.showError(u.data.message||this.tm("messages.saveError"))}catch(l){this.showError(((n=(t=l.response)==null?void 0:t.data)==null?void 0:n.message)||this.tm("messages.saveError"))}this.saving=!1}}}},Q=o=>($("data-v-3c808bb0"),o=o(),ee(),o),te={class:"session-management-page"},ie={class:"text-h4"},ae={class:"d-flex align-center"},oe={class:"text-truncate",style:{"max-width":"300px"}},ne={key:0,class:"d-flex align-center"},re={key:0,class:"ml-2",style:{color:"gray","font-size":"10px"}},de={key:0},ue={key:1},me={key:2},ce={class:"d-flex flex-wrap ga-1"},ge={class:"text-center py-8"},fe={class:"text-h6 mt-4 text-grey-600"},he={class:"text-body-2 text-grey-500"},_e={class:"px-6 py-4"},pe={class:"d-flex align-center mb-4"},ve={class:"font-weight-bold mb-0"},be={class:"d-flex justify-end mt-4"},ke={class:"d-flex align-center mb-4 mt-4"},Ce={class:"font-weight-bold mb-0"},ye={class:"d-flex justify-end mt-4"},xe={class:"d-flex align-center mb-4 mt-4"},Ve={class:"font-weight-bold mb-0"},Ee={class:"d-flex justify-end mt-4"},we={class:"d-flex align-center mb-4 mt-4"},Ue={class:"font-weight-bold mb-0"},De={class:"d-flex justify-end mt-4"},Re={class:"d-flex align-center mb-4 mt-4"},Pe={class:"font-weight-bold mb-0"},Ne={class:"d-flex justify-end mt-4"},Te=Q(()=>m("br",null,null,-1)),Se=Q(()=>m("br",null,null,-1)),qe={class:"mt-3",style:{"max-height":"200px","overflow-y":"auto"}};function ze(o,t,n,l,e,u){return f(),b("div",te,[s(j,{fluid:"",class:"pa-0"},{default:a(()=>[s(y,{flat:""},{default:a(()=>[s(x,{class:"d-flex align-center py-3 px-4"},{default:a(()=>[m("span",ie,r(l.tm("customRules.title")),1),s(g,{icon:"mdi-information-outline",size:"small",variant:"text",href:"https://astrbot.app/use/custom-rules.html",target:"_blank"}),s(v,{size:"small",class:"ml-1"},{default:a(()=>[d(r(e.totalItems)+" "+r(l.tm("customRules.rulesCount")),1)]),_:1}),s(V,{class:"me-4 ms-4",dense:""},{default:a(()=>[s(P,{modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=i=>e.searchQuery=i),"prepend-inner-icon":"mdi-magnify",label:l.tm("search.placeholder"),"hide-details":"",clearable:"",variant:"solo-filled",flat:"",class:"me-4",density:"compact"},null,8,["modelValue","label"])]),_:1}),e.selectedItems.length>0?(f(),k(g,{key:0,color:"error","prepend-icon":"mdi-delete",variant:"tonal",onClick:u.confirmBatchDelete,class:"mr-2",size:"small"},{default:a(()=>[d(r(l.tm("buttons.batchDelete"))+" ("+r(e.selectedItems.length)+") ",1)]),_:1},8,["onClick"])):p("",!0),s(g,{color:"success","prepend-icon":"mdi-plus",variant:"tonal",onClick:u.openAddRuleDialog,class:"mr-2",size:"small"},{default:a(()=>[d(r(l.tm("buttons.addRule")),1)]),_:1},8,["onClick"]),s(g,{color:"primary","prepend-icon":"mdi-refresh",variant:"tonal",onClick:u.refreshData,loading:e.loading,size:"small"},{default:a(()=>[d(r(l.tm("buttons.refresh")),1)]),_:1},8,["onClick","loading"])]),_:1}),s(M),s(E,{class:"pa-0"},{default:a(()=>[s(F,{headers:u.headers,items:u.filteredRulesList,loading:e.loading,"items-length":e.totalItems,"items-per-page":e.itemsPerPage,"onUpdate:itemsPerPage":t[1]||(t[1]=i=>e.itemsPerPage=i),page:e.currentPage,"onUpdate:page":t[2]||(t[2]=i=>e.currentPage=i),"onUpdate:options":u.onTableOptionsUpdate,class:"elevation-0",style:{"font-size":"12px"},modelValue:e.selectedItems,"onUpdate:modelValue":t[3]||(t[3]=i=>e.selectedItems=i),"show-select":"","item-value":"umo","return-object":""},{"item.umo_info":a(({item:i})=>{var c,D,z,I,L,O;return[m("div",null,[m("div",ae,[s(v,{size:"x-small",color:u.getPlatformColor(i.platform),class:"mr-2"},{default:a(()=>[d(r(i.platform||"unknown"),1)]),_:2},1032,["color"]),m("span",oe,r(i.umo),1),((D=(c=i.rules)==null?void 0:c.session_service_config)!=null&&D.custom_name,f(),b("div",ne,[(I=(z=i.rules)==null?void 0:z.session_service_config)!=null&&I.custom_name?(f(),b("span",re," ("+r((O=(L=i.rules)==null?void 0:L.session_service_config)==null?void 0:O.custom_name)+") ",1)):p("",!0),s(g,{icon:"",size:"x-small",variant:"text",class:"ml-1",onClick:W(K=>u.openQuickEditName(i),["stop"])},{default:a(()=>[s(C,{size:"small",color:"grey"},{default:a(()=>[d("mdi-pencil-outline")]),_:1}),s(N,{activator:"parent",location:"top"},{default:a(()=>[d(r(l.tm("buttons.editCustomName")),1)]),_:1})]),_:2},1032,["onClick"])])),s(N,{location:"top"},{activator:a(({props:K})=>[s(C,G(K,{size:"small",class:"ml-1"}),{default:a(()=>[d("mdi-information-outline")]),_:2},1040)]),default:a(()=>[m("div",null,[m("p",null,"UMO: "+r(i.umo),1),i.platform?(f(),b("p",de,"å¹³å°: "+r(i.platform),1)):p("",!0),i.message_type?(f(),b("p",ue,"æ¶ˆæ¯ç±»åž‹: "+r(i.message_type),1)):p("",!0),i.session_id?(f(),b("p",me,"ä¼šè¯ ID: "+r(i.session_id),1)):p("",!0)])]),_:2},1024)])])]}),"item.rules_overview":a(({item:i})=>[m("div",ce,[i.rules.session_service_config?(f(),k(v,{key:0,size:"x-small",color:"primary",variant:"outlined"},{default:a(()=>[d(r(l.tm("customRules.serviceConfig")),1)]),_:1})):p("",!0),i.rules.session_plugin_config?(f(),k(v,{key:1,size:"x-small",color:"secondary",variant:"outlined"},{default:a(()=>[d(r(l.tm("customRules.pluginConfig")),1)]),_:1})):p("",!0),i.rules.kb_config?(f(),k(v,{key:2,size:"x-small",color:"info",variant:"outlined"},{default:a(()=>[d(r(l.tm("customRules.kbConfig")),1)]),_:1})):p("",!0),u.hasProviderConfig(i.rules)?(f(),k(v,{key:3,size:"x-small",color:"warning",variant:"outlined"},{default:a(()=>[d(r(l.tm("customRules.providerConfig")),1)]),_:1})):p("",!0)])]),"item.actions":a(({item:i})=>[s(g,{size:"small",variant:"tonal",color:"primary",onClick:c=>u.openRuleEditor(i),class:"mr-1"},{default:a(()=>[s(C,null,{default:a(()=>[d("mdi-pencil")]),_:1}),s(N,{activator:"parent",location:"top"},{default:a(()=>[d(r(l.tm("buttons.editRule")),1)]),_:1})]),_:2},1032,["onClick"]),s(g,{size:"small",variant:"tonal",color:"error",onClick:c=>u.confirmDeleteRules(i)},{default:a(()=>[s(C,null,{default:a(()=>[d("mdi-delete")]),_:1}),s(N,{activator:"parent",location:"top"},{default:a(()=>[d(r(l.tm("buttons.deleteAllRules")),1)]),_:1})]),_:2},1032,["onClick"])]),"no-data":a(()=>[m("div",ge,[s(C,{size:"64",color:"grey-400"},{default:a(()=>[d("mdi-file-document-edit-outline")]),_:1}),m("div",fe,r(l.tm("customRules.noRules")),1),m("div",he,r(l.tm("customRules.noRulesDesc")),1),s(g,{color:"primary",variant:"tonal",class:"mt-4",onClick:u.openAddRuleDialog},{default:a(()=>[s(C,{start:""},{default:a(()=>[d("mdi-plus")]),_:1}),d(" "+r(l.tm("buttons.addRule")),1)]),_:1},8,["onClick"])])]),_:1},8,["headers","items","loading","items-length","items-per-page","page","onUpdate:options","modelValue"])]),_:1})]),_:1}),s(R,{modelValue:e.addRuleDialog,"onUpdate:modelValue":t[7]||(t[7]=i=>e.addRuleDialog=i),"max-width":"600"},{default:a(()=>[s(y,null,{default:a(()=>[s(x,{class:"py-3 px-4",style:{display:"flex","align-items":"center"}},{default:a(()=>[m("span",null,r(l.tm("addRule.title")),1),s(w),s(g,{icon:"",variant:"text",onClick:t[4]||(t[4]=i=>e.addRuleDialog=!1)},{default:a(()=>[s(C,null,{default:a(()=>[d("mdi-close")]),_:1})]),_:1})]),_:1}),s(E,{class:"pa-4"},{default:a(()=>[s(q,{type:"info",variant:"tonal",class:"mb-4"},{default:a(()=>[d(r(l.tm("addRule.description")),1)]),_:1}),s(H,{modelValue:e.selectedNewUmo,"onUpdate:modelValue":t[5]||(t[5]=i=>e.selectedNewUmo=i),items:e.availableUmos,loading:e.loadingUmos,label:l.tm("addRule.selectUmo"),variant:"outlined",clearable:"","no-data-text":l.tm("addRule.noUmos")},null,8,["modelValue","items","loading","label","no-data-text"])]),_:1}),s(T,{class:"px-4 pb-4"},{default:a(()=>[s(w),s(g,{variant:"text",onClick:t[6]||(t[6]=i=>e.addRuleDialog=!1)},{default:a(()=>[d(r(l.tm("buttons.cancel")),1)]),_:1}),s(g,{color:"primary",variant:"tonal",onClick:u.createNewRule,disabled:!e.selectedNewUmo},{default:a(()=>[d(r(l.tm("buttons.next")),1)]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(R,{modelValue:e.ruleDialog,"onUpdate:modelValue":t[20]||(t[20]=i=>e.ruleDialog=i),"max-width":"550",scrollable:""},{default:a(()=>[e.selectedUmo?(f(),k(y,{key:0,class:"d-flex flex-column",height:"600"},{default:a(()=>[s(x,{class:"py-3 px-6 d-flex align-center border-b"},{default:a(()=>[m("span",null,r(l.tm("ruleEditor.title")),1),s(v,{size:"x-small",class:"ml-2 font-weight-regular",variant:"outlined"},{default:a(()=>[d(r(e.selectedUmo.umo),1)]),_:1}),s(w),s(g,{icon:"mdi-close",variant:"text",onClick:u.closeRuleEditor},null,8,["onClick"])]),_:1}),s(E,{class:"pa-0 overflow-y-auto"},{default:a(()=>[m("div",_e,[m("div",pe,[m("h3",ve,r(l.tm("ruleEditor.serviceConfig.title")),1)]),s(V,{dense:""},{default:a(()=>[s(h,{cols:"12"},{default:a(()=>[s(S,{modelValue:e.serviceConfig.session_enabled,"onUpdate:modelValue":t[8]||(t[8]=i=>e.serviceConfig.session_enabled=i),label:l.tm("ruleEditor.serviceConfig.sessionEnabled"),color:"success","hide-details":"",class:"mb-2"},null,8,["modelValue","label"])]),_:1}),s(h,{cols:"12",md:"6"},{default:a(()=>[s(S,{modelValue:e.serviceConfig.llm_enabled,"onUpdate:modelValue":t[9]||(t[9]=i=>e.serviceConfig.llm_enabled=i),label:l.tm("ruleEditor.serviceConfig.llmEnabled"),color:"primary","hide-details":""},null,8,["modelValue","label"])]),_:1}),s(h,{cols:"12",md:"6"},{default:a(()=>[s(S,{modelValue:e.serviceConfig.tts_enabled,"onUpdate:modelValue":t[10]||(t[10]=i=>e.serviceConfig.tts_enabled=i),label:l.tm("ruleEditor.serviceConfig.ttsEnabled"),color:"secondary","hide-details":""},null,8,["modelValue","label"])]),_:1}),s(h,{cols:"12",class:"mt-2"},{default:a(()=>[s(P,{modelValue:e.serviceConfig.custom_name,"onUpdate:modelValue":t[11]||(t[11]=i=>e.serviceConfig.custom_name=i),label:l.tm("ruleEditor.serviceConfig.customName"),variant:"outlined","hide-details":"",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),m("div",be,[s(g,{color:"primary",variant:"tonal",size:"small",onClick:u.saveServiceConfig,loading:e.saving,"prepend-icon":"mdi-content-save"},{default:a(()=>[d(r(l.tm("buttons.save")),1)]),_:1},8,["onClick","loading"])]),m("div",ke,[m("h3",Ce,r(l.tm("ruleEditor.providerConfig.title")),1)]),s(V,{dense:""},{default:a(()=>[s(h,{cols:"12"},{default:a(()=>[s(U,{modelValue:e.providerConfig.chat_completion,"onUpdate:modelValue":t[12]||(t[12]=i=>e.providerConfig.chat_completion=i),items:u.chatProviderOptions,"item-title":"label","item-value":"value",label:l.tm("ruleEditor.providerConfig.chatProvider"),variant:"outlined","hide-details":"",class:"mb-2"},null,8,["modelValue","items","label"])]),_:1}),s(h,{cols:"12"},{default:a(()=>[s(U,{modelValue:e.providerConfig.speech_to_text,"onUpdate:modelValue":t[13]||(t[13]=i=>e.providerConfig.speech_to_text=i),items:u.sttProviderOptions,"item-title":"label","item-value":"value",label:l.tm("ruleEditor.providerConfig.sttProvider"),variant:"outlined","hide-details":"",disabled:e.availableSttProviders.length===0,class:"mb-2"},null,8,["modelValue","items","label","disabled"])]),_:1}),s(h,{cols:"12"},{default:a(()=>[s(U,{modelValue:e.providerConfig.text_to_speech,"onUpdate:modelValue":t[14]||(t[14]=i=>e.providerConfig.text_to_speech=i),items:u.ttsProviderOptions,"item-title":"label","item-value":"value",label:l.tm("ruleEditor.providerConfig.ttsProvider"),variant:"outlined","hide-details":"",disabled:e.availableTtsProviders.length===0},null,8,["modelValue","items","label","disabled"])]),_:1})]),_:1}),m("div",ye,[s(g,{color:"primary",variant:"tonal",size:"small",onClick:u.saveProviderConfig,loading:e.saving,"prepend-icon":"mdi-content-save"},{default:a(()=>[d(r(l.tm("buttons.save")),1)]),_:1},8,["onClick","loading"])]),m("div",xe,[m("h3",Ve,r(l.tm("ruleEditor.personaConfig.title")),1)]),s(V,{dense:""},{default:a(()=>[s(h,{cols:"12"},{default:a(()=>[s(U,{modelValue:e.serviceConfig.persona_id,"onUpdate:modelValue":t[15]||(t[15]=i=>e.serviceConfig.persona_id=i),items:u.personaOptions,"item-title":"label","item-value":"value",label:l.tm("ruleEditor.personaConfig.selectPersona"),variant:"outlined","hide-details":"",clearable:""},null,8,["modelValue","items","label"])]),_:1}),s(h,{cols:"12"},{default:a(()=>[s(q,{type:"info",variant:"tonal",class:"mt-2",icon:"mdi-information-outline"},{default:a(()=>[d(r(l.tm("ruleEditor.personaConfig.hint")),1)]),_:1})]),_:1})]),_:1}),m("div",Ee,[s(g,{color:"primary",variant:"tonal",size:"small",onClick:u.saveServiceConfig,loading:e.saving,"prepend-icon":"mdi-content-save"},{default:a(()=>[d(r(l.tm("buttons.save")),1)]),_:1},8,["onClick","loading"])]),m("div",we,[m("h3",Ue,r(l.tm("ruleEditor.pluginConfig.title")),1)]),s(V,{dense:""},{default:a(()=>[s(h,{cols:"12"},{default:a(()=>[s(U,{modelValue:e.pluginConfig.disabled_plugins,"onUpdate:modelValue":t[16]||(t[16]=i=>e.pluginConfig.disabled_plugins=i),items:u.pluginOptions,"item-title":"label","item-value":"value",label:l.tm("ruleEditor.pluginConfig.disabledPlugins"),variant:"outlined","hide-details":"",multiple:"",chips:"","closable-chips":"",clearable:""},null,8,["modelValue","items","label"])]),_:1}),s(h,{cols:"12"},{default:a(()=>[s(q,{type:"info",variant:"tonal",class:"mt-2",icon:"mdi-information-outline"},{default:a(()=>[d(r(l.tm("ruleEditor.pluginConfig.hint")),1)]),_:1})]),_:1})]),_:1}),m("div",De,[s(g,{color:"primary",variant:"tonal",size:"small",onClick:u.savePluginConfig,loading:e.saving,"prepend-icon":"mdi-content-save"},{default:a(()=>[d(r(l.tm("buttons.save")),1)]),_:1},8,["onClick","loading"])]),m("div",Re,[m("h3",Pe,r(l.tm("ruleEditor.kbConfig.title")),1)]),s(V,{dense:""},{default:a(()=>[s(h,{cols:"12"},{default:a(()=>[s(U,{modelValue:e.kbConfig.kb_ids,"onUpdate:modelValue":t[17]||(t[17]=i=>e.kbConfig.kb_ids=i),items:u.kbOptions,"item-title":"label","item-value":"value",disabled:e.availableKbs.length===0,label:l.tm("ruleEditor.kbConfig.selectKbs"),variant:"outlined","hide-details":"",multiple:"",chips:"","closable-chips":"",clearable:""},null,8,["modelValue","items","disabled","label"])]),_:1}),s(h,{cols:"12",md:"6"},{default:a(()=>[s(P,{modelValue:e.kbConfig.top_k,"onUpdate:modelValue":t[18]||(t[18]=i=>e.kbConfig.top_k=i),modelModifiers:{number:!0},label:l.tm("ruleEditor.kbConfig.topK"),variant:"outlined","hide-details":"",type:"number",min:"1",max:"20",class:"mt-3"},null,8,["modelValue","label"])]),_:1}),s(h,{cols:"12",md:"6"},{default:a(()=>[s(S,{modelValue:e.kbConfig.enable_rerank,"onUpdate:modelValue":t[19]||(t[19]=i=>e.kbConfig.enable_rerank=i),label:l.tm("ruleEditor.kbConfig.enableRerank"),color:"primary","hide-details":"",class:"mt-3"},null,8,["modelValue","label"])]),_:1})]),_:1}),m("div",Ne,[s(g,{color:"primary",variant:"tonal",size:"small",onClick:u.saveKbConfig,loading:e.saving,"prepend-icon":"mdi-content-save"},{default:a(()=>[d(r(l.tm("buttons.save")),1)]),_:1},8,["onClick","loading"])])])]),_:1})]),_:1})):p("",!0)]),_:1},8,["modelValue"]),s(R,{modelValue:e.deleteDialog,"onUpdate:modelValue":t[22]||(t[22]=i=>e.deleteDialog=i),"max-width":"400"},{default:a(()=>[s(y,null,{default:a(()=>[s(x,{class:"text-h6"},{default:a(()=>[d(r(l.tm("deleteConfirm.title")),1)]),_:1}),s(E,null,{default:a(()=>{var i;return[d(r(l.tm("deleteConfirm.message"))+" ",1),Te,Se,m("code",null,r((i=e.deleteTarget)==null?void 0:i.umo),1)]}),_:1}),s(T,null,{default:a(()=>[s(w),s(g,{variant:"text",onClick:t[21]||(t[21]=i=>e.deleteDialog=!1)},{default:a(()=>[d(r(l.tm("buttons.cancel")),1)]),_:1}),s(g,{color:"error",variant:"tonal",onClick:u.deleteAllRules,loading:e.deleting},{default:a(()=>[d(r(l.tm("buttons.delete")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(R,{modelValue:e.batchDeleteDialog,"onUpdate:modelValue":t[24]||(t[24]=i=>e.batchDeleteDialog=i),"max-width":"500"},{default:a(()=>[s(y,null,{default:a(()=>[s(x,{class:"text-h6"},{default:a(()=>[d(r(l.tm("batchDeleteConfirm.title")),1)]),_:1}),s(E,null,{default:a(()=>[d(r(l.tm("batchDeleteConfirm.message",{count:e.selectedItems.length}))+" ",1),m("div",qe,[(f(!0),b(J,null,X(e.selectedItems,i=>(f(),k(v,{key:i.umo,size:"small",class:"ma-1",variant:"outlined"},{default:a(()=>{var c,D;return[d(r(((D=(c=i.rules)==null?void 0:c.session_service_config)==null?void 0:D.custom_name)||i.umo),1)]}),_:2},1024))),128))])]),_:1}),s(T,null,{default:a(()=>[s(w),s(g,{variant:"text",onClick:t[23]||(t[23]=i=>e.batchDeleteDialog=!1)},{default:a(()=>[d(r(l.tm("buttons.cancel")),1)]),_:1}),s(g,{color:"error",variant:"tonal",onClick:u.batchDeleteRules,loading:e.deleting},{default:a(()=>[d(r(l.tm("buttons.delete")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Y,{modelValue:e.snackbar,"onUpdate:modelValue":t[25]||(t[25]=i=>e.snackbar=i),timeout:3e3,elevation:"24",color:e.snackbarColor,location:"top"},{default:a(()=>[d(r(e.snackbarText),1)]),_:1},8,["modelValue","color"]),s(R,{modelValue:e.quickEditNameDialog,"onUpdate:modelValue":t[28]||(t[28]=i=>e.quickEditNameDialog=i),"max-width":"400"},{default:a(()=>[s(y,null,{default:a(()=>[s(x,{class:"py-3 px-4"},{default:a(()=>[d(r(l.tm("quickEditName.title")),1)]),_:1}),s(E,{class:"pa-4"},{default:a(()=>[s(P,{modelValue:e.quickEditNameValue,"onUpdate:modelValue":t[26]||(t[26]=i=>e.quickEditNameValue=i),label:l.tm("ruleEditor.serviceConfig.customName"),variant:"outlined","hide-details":"",clearable:"",autofocus:"",onKeyup:Z(u.saveQuickEditName,["enter"])},null,8,["modelValue","label","onKeyup"])]),_:1}),s(T,{class:"px-4 pb-4"},{default:a(()=>[s(w),s(g,{variant:"text",onClick:t[27]||(t[27]=i=>e.quickEditNameDialog=!1)},{default:a(()=>[d(r(l.tm("buttons.cancel")),1)]),_:1}),s(g,{color:"primary",variant:"tonal",onClick:u.saveQuickEditName,loading:e.saving},{default:a(()=>[d(r(l.tm("buttons.save")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}const Oe=se(le,[["render",ze],["__scopeId","data-v-3c808bb0"]]);export{Oe as default};

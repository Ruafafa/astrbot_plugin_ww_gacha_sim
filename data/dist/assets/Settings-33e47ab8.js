import{u as Re,v as f,M as at,o as m,g as h,b as e,w as t,e as o,t as s,f as r,B as g,y as re,z as ie,A as p,C as ne,al as st,am as Be,O as ue,Q as Z,F as H,h as ae,a as F,V as q,l as v,d as Ce,H as ze,I as Ve,J as De,c as te,x as Fe,K as D,aD as lt,aE as be,aI as ot,aJ as ye,G,E as he,a1 as xe,p as $,aK as rt,k as ee,q as it,a5 as nt,aq as ut,R as ct,S as dt,ae as pt,aG as we}from"./index-61371d60.js";import{W as Le}from"./WaitingForRestart-d6ba996f.js";import{P as mt}from"./ProxySelector-8a48acfd.js";import{g as ft,r as vt,b as gt,c as _t,s as kt,M as bt}from"./MigrationDialog-eaf64b46.js";import{_ as $e}from"./_plugin-vue_export-helper-c27b6911.js";import"./common-619402c2.js";import"./ConsoleDisplayer-69ceb810.js";const yt={style:{"margin-top":"16px"}},ht={class:"text-body-2 mb-4"},xt={class:"mb-2 font-weight-medium"},wt={class:"mb-2 font-weight-medium"},Ct={__name:"SidebarCustomizer",setup(J){const{t:_}=Re(),l=f(!1),w=f([]),b=f([]),V=f(null);function z(){const y=ft(),{mainItems:d,moreItems:n}=vt(kt,y);w.value=d,b.value=n}function U(){z(),l.value=!0}function I(y,d,n){V.value={type:d,index:n,item:d==="main"?w.value[n]:b.value[n]},y.dataTransfer.effectAllowed="move"}function j(y,d,n){if(y.preventDefault(),!V.value)return;const x=V.value.type,C=V.value.index,T=V.value.item;x==="main"?w.value.splice(C,1):b.value.splice(C,1),d==="main"?w.value.splice(n,0,T):b.value.splice(n,0,T),V.value=null}function N(y,d){if(y.preventDefault(),!V.value)return;const n=V.value.type,x=V.value.index,C=V.value.item;n==="main"?w.value.splice(x,1):b.value.splice(x,1),d==="main"?w.value.push(C):b.value.push(C),V.value=null}function k(y){const d=w.value.splice(y,1)[0];b.value.push(d)}function O(y){const d=b.value.splice(y,1)[0];w.value.push(d)}function Q(){const y={mainItems:w.value.map(d=>d.title),moreItems:b.value.map(d=>d.title)};gt(y),window.dispatchEvent(new CustomEvent("sidebar-customization-changed")),l.value=!1}function K(){_t(),z(),window.dispatchEvent(new CustomEvent("sidebar-customization-changed"))}return at(()=>{z()}),(y,d)=>(m(),h("div",yt,[e(g,{color:"primary",variant:"outlined",size:"small",onClick:U,style:{"margin-bottom":"8px"}},{default:t(()=>[o(s(r(_)("features.settings.sidebar.customize.title")),1)]),_:1}),e(De,{modelValue:l.value,"onUpdate:modelValue":d[7]||(d[7]=n=>l.value=n),"max-width":"700px"},{default:t(()=>[e(re,null,{default:t(()=>[e(ie,{class:"d-flex justify-space-between align-center"},{default:t(()=>[p("span",null,s(r(_)("features.settings.sidebar.customize.title")),1),e(g,{icon:"mdi-close",variant:"text",onClick:d[0]||(d[0]=n=>l.value=!1)})]),_:1}),e(ne,null,{default:t(()=>[p("p",ht,s(r(_)("features.settings.sidebar.customize.subtitle")),1),e(st,null,{default:t(()=>[e(Be,{cols:"12",md:"6"},{default:t(()=>[p("div",xt,s(r(_)("features.settings.sidebar.customize.mainItems")),1),e(ue,{density:"compact",class:"custom-list",onDragover:d[2]||(d[2]=Z(()=>{},["prevent"])),onDrop:d[3]||(d[3]=n=>N(n,"main"))},{default:t(()=>[(m(!0),h(H,null,ae(w.value,(n,x)=>(m(),F(q,{key:n.title,class:"mb-1 draggable-item",draggable:"true",onDragstart:C=>I(C,"main",x),onDragover:d[1]||(d[1]=Z(()=>{},["prevent"])),onDrop:Z(C=>j(C,"main",x),["stop"])},{prepend:t(()=>[e(v,{icon:n.icon,size:"small",class:"mr-2"},null,8,["icon"])]),append:t(()=>[e(g,{icon:"mdi-arrow-right",variant:"text",size:"x-small",onClick:C=>k(x)},null,8,["onClick"])]),default:t(()=>[e(Ce,null,{default:t(()=>[o(s(r(_)(n.title)),1)]),_:2},1024)]),_:2},1032,["onDragstart","onDrop"]))),128))]),_:1})]),_:1}),e(Be,{cols:"12",md:"6"},{default:t(()=>[p("div",wt,s(r(_)("features.settings.sidebar.customize.moreItems")),1),e(ue,{density:"compact",class:"custom-list",onDragover:d[5]||(d[5]=Z(()=>{},["prevent"])),onDrop:d[6]||(d[6]=n=>N(n,"more"))},{default:t(()=>[(m(!0),h(H,null,ae(b.value,(n,x)=>(m(),F(q,{key:n.title,class:"mb-1 draggable-item",draggable:"true",onDragstart:C=>I(C,"more",x),onDragover:d[4]||(d[4]=Z(()=>{},["prevent"])),onDrop:Z(C=>j(C,"more",x),["stop"])},{prepend:t(()=>[e(v,{icon:n.icon,size:"small",class:"mr-2"},null,8,["icon"])]),append:t(()=>[e(g,{icon:"mdi-arrow-left",variant:"text",size:"x-small",onClick:C=>O(x)},null,8,["onClick"])]),default:t(()=>[e(Ce,null,{default:t(()=>[o(s(r(_)(n.title)),1)]),_:2},1024)]),_:2},1032,["onDragstart","onDrop"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(ze,null,{default:t(()=>[e(g,{color:"error",variant:"text",onClick:K},{default:t(()=>[o(s(r(_)("features.settings.sidebar.customize.reset")),1)]),_:1}),e(Ve),e(g,{color:"primary",onClick:Q},{default:t(()=>[o(s(r(_)("core.actions.save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},zt=$e(Ct,[["__scopeId","data-v-9674b3df"]]);const Ae=J=>(ct("data-v-0e74cd71"),J=J(),dt(),J),Vt={key:0,class:"text-center py-8"},Dt={class:"mb-4"},It={class:"mb-4 text-grey"},Tt={key:1,class:"text-center py-8"},Et={class:"mb-4"},Mt={class:"text-grey"},St={key:2,class:"text-center py-8"},Bt={class:"mb-4"},Ft={class:"mb-4"},Rt={key:3,class:"text-center py-8"},Lt={class:"mb-4"},$t={key:0,class:"py-4"},At={class:"d-flex justify-center"},Pt={key:1,class:"text-center py-8"},Ut={class:"mb-4"},jt={class:"text-grey mb-2"},Nt={class:"text-grey-darken-1 mb-4"},Ot={key:2,class:"py-4"},Kt={class:"confirm-message"},Wt={class:"text-h6 mb-2"},qt={class:"mb-2"},Gt=Ae(()=>p("br",null,null,-1)),Ht={key:0,class:"mb-2"},Jt={class:"mt-3",style:{"white-space":"pre-line"}},Qt={class:"d-flex flex-wrap ga-2"},Xt={class:"d-flex justify-center align-center mt-4",style:{gap:"16px"}},Yt={key:3,class:"text-center py-8"},Zt={class:"mb-4"},ea={class:"text-grey"},ta={key:4,class:"text-center py-8"},aa={class:"mb-4"},sa={key:5,class:"text-center py-8"},la={class:"mb-4"},oa={key:0,class:"text-center py-8"},ra={key:1,class:"text-center py-8"},ia={class:"text-grey"},na={class:"d-flex justify-center mt-4"},ua={class:"text-caption text-grey text-center mt-4"},ca=Ae(()=>p("span",{class:"text-grey"},".zip",-1)),da={class:"text-caption text-grey mt-1"},pa=5,ma={__name:"BackupDialog",setup(J,{expose:_}){const{t:l}=Re(),w=f(!1),b=f("export"),V=f(null),z=f("idle"),U=f(null),I=f({current:0,total:100,message:""}),j=f(null),N=f(""),k=f("idle"),O=f(null),Q=f(null),K=f({current:0,total:100,message:""}),y=f(""),d=f(""),n=f(null),x=f(""),C=f(0),T=f({uploaded:0,total:0,percent:0,message:""}),ce=f(!1),de=f([]),se=f(!1),pe=f(""),W=f(""),me=f(!1),A=f(""),Ie=te(()=>z.value==="processing"||k.value==="processing"||k.value==="uploading"),Pe=te(()=>{var i;const a=(i=n.value)==null?void 0:i.version_status;return a==="major_diff"?"error":a==="minor_diff"?"warning":"info"}),Ue=te(()=>{var i;const a=(i=n.value)==null?void 0:i.version_status;return a==="major_diff"?"mdi-close-circle":a==="minor_diff"?"mdi-alert":"mdi-check-circle"}),je=te(()=>{var i;const a=(i=n.value)==null?void 0:i.version_status;return l(a==="major_diff"?"features.settings.backup.import.version.majorDiffTitle":a==="minor_diff"?"features.settings.backup.import.version.minorDiffTitle":"features.settings.backup.import.version.matchTitle")}),Ne=te(()=>{var i;const a=(i=n.value)==null?void 0:i.version_status;return l(a==="major_diff"?"features.settings.backup.import.version.majorDiffMessage":a==="minor_diff"?"features.settings.backup.import.version.minorDiffMessage":"features.settings.backup.import.version.matchMessage")});Fe(w,a=>{a?X():Ze()}),Fe(b,a=>{a==="list"&&X()});const X=async()=>{ce.value=!0;try{const a=await D.get("/api/backup/list");a.data.status==="ok"&&(de.value=a.data.data.items||[])}catch(a){console.error("Failed to load backup list:",a)}finally{ce.value=!1}},Oe=async()=>{z.value="processing",I.value={current:0,total:100,message:""};try{const a=await D.post("/api/backup/export");if(a.data.status==="ok")U.value=a.data.data.task_id,fe();else throw new Error(a.data.message)}catch(a){z.value="failed",N.value=a.message||"Export failed"}},fe=async()=>{if(U.value)try{const a=await D.get("/api/backup/progress",{params:{task_id:U.value}});if(a.data.status==="ok"){const i=a.data.data;i.status==="processing"&&i.progress?(I.value={current:i.progress.current||0,total:i.progress.total||100,message:i.progress.message||""},setTimeout(fe,1e3)):i.status==="completed"?(z.value="completed",j.value=i.result,X()):i.status==="failed"?(z.value="failed",N.value=i.error||"Export failed"):setTimeout(fe,1e3)}}catch(a){z.value="failed",N.value=a.message||"Failed to get export progress"}},ve=()=>{z.value="idle",U.value=null,I.value={current:0,total:100,message:""},j.value=null,N.value=""},Ke=async(a,i,u,c)=>{let S=0;const P=[];for(let M=0;M<i;M++){const B=M*c,Y=Math.min(B+c,a.size);P[M]=Y-B}const E=async M=>{const B=M*c,Y=Math.min(B+c,a.size),tt=a.slice(B,Y),oe=new FormData;oe.append("upload_id",u),oe.append("chunk_index",M.toString()),oe.append("chunk",tt);const ke=await D.post("/api/backup/upload/chunk",oe,{headers:{"Content-Type":"multipart/form-data"}});if(ke.data.status!=="ok")throw new Error(ke.data.message);return S+=P[M],T.value.uploaded=S,T.value.percent=Math.round(S/a.size*100),ke},R=Array.from({length:i},(M,B)=>B),L=[];for(;R.length>0||L.length>0;){for(;R.length>0&&L.length<pa;){const M=R.shift(),B=E(M).then(()=>{const Y=L.indexOf(B);Y>-1&&L.splice(Y,1)});L.push(B)}L.length>0&&await Promise.race(L)}},We=async()=>{var i,u;if(!O.value)return;k.value="uploading";const a=O.value;try{T.value={uploaded:0,total:a.size,percent:0,message:l("features.settings.backup.import.uploadInit")};const c=await D.post("/api/backup/upload/init",{filename:a.name,total_size:a.size});if(c.data.status!=="ok")throw new Error(c.data.message);x.value=c.data.data.upload_id,C.value=c.data.data.chunk_size;const S=c.data.data.total_chunks;T.value.message=l("features.settings.backup.import.uploadingChunks"),await Ke(a,S,x.value,C.value),T.value.message=l("features.settings.backup.import.uploadComplete");const P=await D.post("/api/backup/upload/complete",{upload_id:x.value});if(P.data.status!=="ok")throw new Error(P.data.message);d.value=P.data.data.filename,T.value.message=l("features.settings.backup.import.checking");const E=await D.post("/api/backup/check",{filename:d.value});if(E.data.status!=="ok")throw new Error(E.data.message);if(n.value=E.data.data,!n.value.valid){k.value="failed",y.value=n.value.error||l("features.settings.backup.import.invalidBackup");return}k.value="confirm"}catch(c){if(x.value)try{await D.post("/api/backup/upload/abort",{upload_id:x.value})}catch(S){console.error("Failed to abort upload:",S)}k.value="failed",y.value=((u=(i=c.response)==null?void 0:i.data)==null?void 0:u.message)||c.message||"Upload failed"}},qe=async()=>{var a,i;if(d.value){k.value="processing",K.value={current:0,total:100,message:""};try{const u=await D.post("/api/backup/import",{filename:d.value,confirmed:!0});if(u.data.status==="ok")Q.value=u.data.data.task_id,ge();else throw new Error(u.data.message)}catch(u){k.value="failed",y.value=((i=(a=u.response)==null?void 0:a.data)==null?void 0:i.message)||u.message||"Import failed"}}},ge=async()=>{if(Q.value)try{const a=await D.get("/api/backup/progress",{params:{task_id:Q.value}});if(a.data.status==="ok"){const i=a.data.data;i.status==="processing"&&i.progress?(K.value={current:i.progress.current||0,total:i.progress.total||100,message:i.progress.message||""},setTimeout(ge,1e3)):i.status==="completed"?k.value="completed":i.status==="failed"?(k.value="failed",y.value=i.error||"Import failed"):setTimeout(ge,1e3)}}catch(a){k.value="failed",y.value=a.message||"Failed to get import progress"}},le=async()=>{if(x.value&&k.value==="uploading")try{await D.post("/api/backup/upload/abort",{upload_id:x.value})}catch(a){console.error("Failed to abort upload:",a)}k.value="idle",O.value=null,Q.value=null,K.value={current:0,total:100,message:""},y.value="",d.value="",n.value=null,x.value="",C.value=0,T.value={uploaded:0,total:0,percent:0,message:""}},Te=a=>{const i=localStorage.getItem("token");if(!i){alert(l("core.common.unauthorized"));return}const u=`/api/backup/download?filename=${encodeURIComponent(a)}&token=${encodeURIComponent(i)}`,c=document.createElement("a");c.href=u,c.download=a,c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)},Ge=async a=>{var i,u;d.value=a;try{const c=await D.post("/api/backup/check",{filename:a});if(c.data.status!=="ok")throw new Error(c.data.message);if(n.value=c.data.data,!n.value.valid){alert(n.value.error||l("features.settings.backup.import.invalidBackup"));return}b.value="import",k.value="confirm"}catch(c){alert(((u=(i=c.response)==null?void 0:i.data)==null?void 0:u.message)||c.message||"Check failed")}},He=async a=>{if(confirm(l("features.settings.backup.list.confirmDelete")))try{const i=await D.post("/api/backup/delete",{filename:a});i.data.status==="ok"?X():alert(i.data.message||"Delete failed")}catch(i){alert(i.message||"Delete failed")}},Je=a=>{pe.value=a,W.value=a.replace(/\.zip$/i,""),A.value="",se.value=!0},Ee=()=>{se.value=!1,pe.value="",W.value="",A.value=""},Me=a=>a?/[\\/:*?"<>|]/.test(a)||a.includes("..")?l("features.settings.backup.list.renameInvalidChars"):!0:l("features.settings.backup.list.renameRequired"),Se=async()=>{var i,u;if(!W.value||A.value)return;const a=Me(W.value);if(a!==!0){A.value=a;return}me.value=!0,A.value="";try{const c=await D.post("/api/backup/rename",{filename:pe.value,new_name:W.value});c.data.status==="ok"?(Ee(),X()):A.value=c.data.message||l("features.settings.backup.list.renameFailed")}catch(c){A.value=((u=(i=c.response)==null?void 0:i.data)==null?void 0:u.message)||c.message||l("features.settings.backup.list.renameFailed")}finally{me.value=!1}},_e=a=>{if(a===0)return"0 B";const i=1024,u=["B","KB","MB","GB"],c=Math.floor(Math.log(a)/Math.log(i));return parseFloat((a/Math.pow(i,c)).toFixed(2))+" "+u[c]},Qe=a=>new Date(a*1e3).toLocaleString(),Xe=a=>{if(!a)return"";try{return new Date(a).toLocaleString()}catch{return a}},Ye=()=>{D.post("/api/stat/restart-core").then(()=>{V.value&&V.value.check()})},Ze=async()=>{ve(),await le(),b.value="export"},et=()=>{Ie.value||(w.value=!1)};return _({open:()=>{w.value=!0}}),(a,i)=>(m(),h(H,null,[e(De,{modelValue:w.value,"onUpdate:modelValue":i[4]||(i[4]=u=>w.value=u),persistent:"","max-width":"700",scrollable:""},{default:t(()=>[e(re,null,{default:t(()=>[e(ie,{class:"d-flex align-center"},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-backup-restore")]),_:1}),o(" "+s(r(l)("features.settings.backup.dialog.title")),1)]),_:1}),e(ne,{class:"pa-6"},{default:t(()=>[e(lt,{modelValue:b.value,"onUpdate:modelValue":i[0]||(i[0]=u=>b.value=u),color:"primary",class:"mb-4"},{default:t(()=>[e(be,{value:"export"},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-export")]),_:1}),o(" "+s(r(l)("features.settings.backup.tabs.export")),1)]),_:1}),e(be,{value:"import"},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-import")]),_:1}),o(" "+s(r(l)("features.settings.backup.tabs.import")),1)]),_:1}),e(be,{value:"list"},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-format-list-bulleted")]),_:1}),o(" "+s(r(l)("features.settings.backup.tabs.list")),1)]),_:1})]),_:1},8,["modelValue"]),e(ot,{modelValue:b.value,"onUpdate:modelValue":i[3]||(i[3]=u=>b.value=u)},{default:t(()=>[e(ye,{value:"export"},{default:t(()=>{var u;return[z.value==="idle"?(m(),h("div",Vt,[e(v,{size:"64",color:"primary",class:"mb-4"},{default:t(()=>[o("mdi-cloud-upload")]),_:1}),p("h3",Dt,s(r(l)("features.settings.backup.export.title")),1),p("p",It,s(r(l)("features.settings.backup.export.description")),1),e(G,{type:"info",variant:"tonal",class:"mb-4 text-left"},{prepend:t(()=>[e(v,null,{default:t(()=>[o("mdi-information")]),_:1})]),default:t(()=>[o(" "+s(r(l)("features.settings.backup.export.includes")),1)]),_:1}),e(g,{color:"primary",size:"large",onClick:Oe,loading:z.value==="processing"},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-export")]),_:1}),o(" "+s(r(l)("features.settings.backup.export.button")),1)]),_:1},8,["loading"])])):z.value==="processing"?(m(),h("div",Tt,[e(he,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),p("h3",Et,s(r(l)("features.settings.backup.export.processing")),1),p("p",Mt,s(I.value.message||r(l)("features.settings.backup.export.wait")),1),e(xe,{"model-value":I.value.current,max:I.value.total,class:"mt-4",color:"primary"},null,8,["model-value","max"])])):z.value==="completed"?(m(),h("div",St,[e(v,{size:"64",color:"success",class:"mb-4"},{default:t(()=>[o("mdi-check-circle")]),_:1}),p("h3",Bt,s(r(l)("features.settings.backup.export.completed")),1),p("p",Ft,s((u=j.value)==null?void 0:u.filename),1),e(g,{color:"primary",onClick:i[1]||(i[1]=c=>{var S;return Te((S=j.value)==null?void 0:S.filename)}),class:"mr-2"},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-download")]),_:1}),o(" "+s(r(l)("features.settings.backup.export.download")),1)]),_:1}),e(g,{color:"grey",variant:"text",onClick:ve},{default:t(()=>[o(s(r(l)("features.settings.backup.export.another")),1)]),_:1})])):z.value==="failed"?(m(),h("div",Rt,[e(v,{size:"64",color:"error",class:"mb-4"},{default:t(()=>[o("mdi-alert-circle")]),_:1}),p("h3",Lt,s(r(l)("features.settings.backup.export.failed")),1),e(G,{type:"error",variant:"tonal",class:"mb-4"},{default:t(()=>[o(s(N.value),1)]),_:1}),e(g,{color:"primary",onClick:ve},{default:t(()=>[o(s(r(l)("features.settings.backup.export.retry")),1)]),_:1})])):$("",!0)]}),_:1}),e(ye,{value:"import"},{default:t(()=>{var u,c,S,P;return[k.value==="idle"?(m(),h("div",$t,[e(G,{type:"warning",variant:"tonal",class:"mb-4"},{prepend:t(()=>[e(v,null,{default:t(()=>[o("mdi-alert")]),_:1})]),default:t(()=>[o(" "+s(r(l)("features.settings.backup.import.warning")),1)]),_:1}),e(rt,{modelValue:O.value,"onUpdate:modelValue":i[2]||(i[2]=E=>O.value=E),label:r(l)("features.settings.backup.import.selectFile"),accept:".zip","prepend-icon":"mdi-file-upload","show-size":"",class:"mb-4"},null,8,["modelValue","label"]),p("div",At,[e(g,{color:"primary",size:"large",onClick:We,disabled:!O.value,loading:k.value==="uploading"},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-upload")]),_:1}),o(" "+s(r(l)("features.settings.backup.import.uploadAndCheck")),1)]),_:1},8,["disabled","loading"])])])):k.value==="uploading"?(m(),h("div",Pt,[e(v,{size:"64",color:"primary",class:"mb-4"},{default:t(()=>[o("mdi-cloud-upload")]),_:1}),p("h3",Ut,s(r(l)("features.settings.backup.import.uploading")),1),p("p",jt,s(T.value.message||r(l)("features.settings.backup.import.uploadWait")),1),p("p",Nt,s(_e(T.value.uploaded))+" / "+s(_e(T.value.total))+" ("+s(T.value.percent)+"%) ",1),e(xe,{"model-value":T.value.percent,max:100,class:"mt-2",color:"primary",height:"8",rounded:""},null,8,["model-value"])])):k.value==="confirm"?(m(),h("div",Ot,[e(G,{type:Pe.value,variant:"tonal",class:"mb-4"},{prepend:t(()=>[e(v,null,{default:t(()=>[o(s(Ue.value),1)]),_:1})]),default:t(()=>{var E,R,L,M,B;return[p("div",Kt,[p("div",Wt,s(je.value),1),p("div",qt,[p("strong",null,s(r(l)("features.settings.backup.import.version.backupVersion"))+":",1),o(" "+s((E=n.value)==null?void 0:E.backup_version),1),Gt,p("strong",null,s(r(l)("features.settings.backup.import.version.currentVersion"))+":",1),o(" "+s((R=n.value)==null?void 0:R.current_version),1)]),(L=n.value)!=null&&L.backup_time&&((M=n.value)==null?void 0:M.backup_time)!=="未知"?(m(),h("div",Ht,[p("strong",null,s(r(l)("features.settings.backup.import.version.backupTime"))+":",1),o(" "+s(Xe((B=n.value)==null?void 0:B.backup_time)),1)])):$("",!0),p("div",Jt,s(Ne.value),1)])]}),_:1},8,["type"]),(u=n.value)!=null&&u.backup_summary?(m(),F(re,{key:0,variant:"outlined",class:"mb-4"},{default:t(()=>[e(ie,{class:"text-subtitle-1"},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-package-variant")]),_:1}),o(" "+s(r(l)("features.settings.backup.import.backupContents")),1)]),_:1}),e(ne,null,{default:t(()=>{var E;return[p("div",Qt,[(E=n.value.backup_summary.tables)!=null&&E.length?(m(),F(ee,{key:0,size:"small",color:"primary",variant:"tonal",ripple:!1,class:"non-interactive-chip"},{default:t(()=>[o(s(n.value.backup_summary.tables.length)+" "+s(r(l)("features.settings.backup.import.tables")),1)]),_:1})):$("",!0),n.value.backup_summary.has_knowledge_bases?(m(),F(ee,{key:1,size:"small",color:"success",variant:"tonal",ripple:!1,class:"non-interactive-chip"},{default:t(()=>[o(s(r(l)("features.settings.backup.import.knowledgeBases")),1)]),_:1})):$("",!0),n.value.backup_summary.has_config?(m(),F(ee,{key:2,size:"small",color:"info",variant:"tonal",ripple:!1,class:"non-interactive-chip"},{default:t(()=>[o(s(r(l)("features.settings.backup.import.configFiles")),1)]),_:1})):$("",!0),(m(!0),h(H,null,ae(n.value.backup_summary.directories||[],R=>(m(),F(ee,{key:R,size:"small",color:"warning",variant:"tonal",ripple:!1,class:"non-interactive-chip"},{default:t(()=>[o(s(R),1)]),_:2},1024))),128))])]}),_:1})]),_:1})):$("",!0),(S=(c=n.value)==null?void 0:c.warnings)!=null&&S.length?(m(),F(G,{key:1,type:"warning",variant:"tonal",class:"mb-4"},{default:t(()=>[(m(!0),h(H,null,ae(n.value.warnings,(E,R)=>(m(),h("div",{key:R},s(E),1))),128))]),_:1})):$("",!0),p("div",Xt,[e(g,{color:"grey-darken-1",variant:"outlined",size:"large",onClick:le},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-close")]),_:1}),o(" "+s(r(l)("core.common.cancel")),1)]),_:1}),(P=n.value)!=null&&P.can_import?(m(),F(g,{key:0,color:"error",size:"large",variant:"flat",onClick:qe},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-alert")]),_:1}),o(" "+s(r(l)("features.settings.backup.import.confirmImport")),1)]),_:1})):$("",!0)])])):k.value==="processing"?(m(),h("div",Yt,[e(he,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),p("h3",Zt,s(r(l)("features.settings.backup.import.processing")),1),p("p",ea,s(K.value.message||r(l)("features.settings.backup.import.wait")),1),e(xe,{"model-value":K.value.current,max:K.value.total,class:"mt-4",color:"primary"},null,8,["model-value","max"])])):k.value==="completed"?(m(),h("div",ta,[e(v,{size:"64",color:"success",class:"mb-4"},{default:t(()=>[o("mdi-check-circle")]),_:1}),p("h3",aa,s(r(l)("features.settings.backup.import.completed")),1),e(G,{type:"info",variant:"tonal",class:"mb-4"},{default:t(()=>[o(s(r(l)("features.settings.backup.import.restartRequired")),1)]),_:1}),e(g,{color:"primary",onClick:Ye,class:"mr-2"},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-restart")]),_:1}),o(" "+s(r(l)("features.settings.backup.import.restartNow")),1)]),_:1}),e(g,{color:"grey",variant:"text",onClick:le},{default:t(()=>[o(s(r(l)("core.common.close")),1)]),_:1})])):k.value==="failed"?(m(),h("div",sa,[e(v,{size:"64",color:"error",class:"mb-4"},{default:t(()=>[o("mdi-alert-circle")]),_:1}),p("h3",la,s(r(l)("features.settings.backup.import.failed")),1),e(G,{type:"error",variant:"tonal",class:"mb-4"},{default:t(()=>[o(s(y.value),1)]),_:1}),e(g,{color:"primary",onClick:le},{default:t(()=>[o(s(r(l)("features.settings.backup.import.retry")),1)]),_:1})])):$("",!0)]}),_:1}),e(ye,{value:"list"},{default:t(()=>[ce.value?(m(),h("div",oa,[e(he,{indeterminate:"",color:"primary"})])):de.value.length===0?(m(),h("div",ra,[e(v,{size:"64",color:"grey",class:"mb-4"},{default:t(()=>[o("mdi-folder-open-outline")]),_:1}),p("p",ia,s(r(l)("features.settings.backup.list.empty")),1)])):(m(),F(ue,{key:2,lines:"two"},{default:t(()=>[(m(!0),h(H,null,ae(de.value,u=>(m(),F(q,{key:u.filename},{prepend:t(()=>[e(v,{color:u.type==="uploaded"?"orange":"primary"},{default:t(()=>[o(s(u.type==="uploaded"?"mdi-upload":"mdi-zip-box"),1)]),_:2},1032,["color"])]),append:t(()=>[e(g,{icon:"mdi-restore",variant:"text",size:"small",color:"success",title:r(l)("features.settings.backup.list.restore"),onClick:c=>Ge(u.filename)},null,8,["title","onClick"]),e(g,{icon:"mdi-pencil",variant:"text",size:"small",title:r(l)("features.settings.backup.list.rename"),onClick:c=>Je(u.filename)},null,8,["title","onClick"]),e(g,{icon:"mdi-download",variant:"text",size:"small",onClick:c=>Te(u.filename)},null,8,["onClick"]),e(g,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:c=>He(u.filename)},null,8,["onClick"])]),default:t(()=>[e(Ce,null,{default:t(()=>[o(s(u.filename),1)]),_:2},1024),e(it,null,{default:t(()=>[o(s(_e(u.size))+" · "+s(Qe(u.created_at))+" ",1),e(ee,{size:"x-small",color:"primary",variant:"tonal",class:"ml-2"},{default:t(()=>[o(" v"+s(u.astrbot_version),1)]),_:2},1024),u.type==="uploaded"?(m(),F(ee,{key:0,size:"x-small",color:"orange",variant:"tonal",class:"ml-1"},{default:t(()=>[o(s(r(l)("features.settings.backup.list.uploaded")),1)]),_:1})):$("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})),p("div",na,[e(g,{color:"primary",variant:"text",onClick:X},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-refresh")]),_:1}),o(" "+s(r(l)("features.settings.backup.list.refresh")),1)]),_:1})]),p("p",ua,[e(v,{size:"small",class:"mr-1"},{default:t(()=>[o("mdi-information-outline")]),_:1}),o(" "+s(r(l)("features.settings.backup.list.ftpHint")),1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ze,{class:"px-6 py-4"},{default:t(()=>[e(Ve),e(g,{color:"grey",variant:"text",onClick:et,disabled:Ie.value},{default:t(()=>[o(s(r(l)("core.common.close")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(De,{modelValue:se.value,"onUpdate:modelValue":i[6]||(i[6]=u=>se.value=u),"max-width":"450",persistent:""},{default:t(()=>[e(re,null,{default:t(()=>[e(ie,null,{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-pencil")]),_:1}),o(" "+s(r(l)("features.settings.backup.list.renameTitle")),1)]),_:1}),e(ne,null,{default:t(()=>[e(nt,{modelValue:W.value,"onUpdate:modelValue":i[5]||(i[5]=u=>W.value=u),label:r(l)("features.settings.backup.list.newName"),rules:[Me],"error-messages":A.value,variant:"outlined",density:"comfortable",autofocus:"",onKeyup:ut(Se,["enter"])},{"append-inner":t(()=>[ca]),_:1},8,["modelValue","label","rules","error-messages","onKeyup"]),p("p",da,s(r(l)("features.settings.backup.list.renameHint")),1)]),_:1}),e(ze,null,{default:t(()=>[e(Ve),e(g,{color:"grey",variant:"text",onClick:Ee},{default:t(()=>[o(s(r(l)("core.common.cancel")),1)]),_:1}),e(g,{color:"primary",variant:"flat",onClick:Se,loading:me.value,disabled:!W.value||!!A.value},{default:t(()=>[o(s(r(l)("core.common.confirm")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Le,{ref_key:"wfr",ref:V},null,512)],64))}},fa=$e(ma,[["__scopeId","data-v-0e74cd71"]]),va={style:{"background-color":"var(--v-theme-surface, #fff)",padding:"8px","padding-left":"16px","border-radius":"8px","margin-bottom":"16px"}},Ca={__name:"Settings",setup(J){const{tm:_}=pt("features/settings"),l=f(null),w=f(null),b=f(null),V=()=>{D.post("/api/stat/restart-core").then(()=>{l.value.check()})},z=async()=>{if(w.value)try{const I=await w.value.open();I.success&&console.log("Migration completed successfully:",I.message)}catch(I){console.error("Migration dialog error:",I)}},U=()=>{b.value&&b.value.open()};return(I,j)=>(m(),h(H,null,[p("div",va,[e(ue,{lines:"two"},{default:t(()=>[e(we,null,{default:t(()=>[o(s(r(_)("network.title")),1)]),_:1}),e(q,null,{default:t(()=>[e(mt)]),_:1}),e(we,null,{default:t(()=>[o(s(r(_)("sidebar.title")),1)]),_:1}),e(q,{subtitle:r(_)("sidebar.customize.subtitle"),title:r(_)("sidebar.customize.title")},{default:t(()=>[e(zt)]),_:1},8,["subtitle","title"]),e(we,null,{default:t(()=>[o(s(r(_)("system.title")),1)]),_:1}),e(q,{subtitle:r(_)("system.backup.subtitle"),title:r(_)("system.backup.title")},{default:t(()=>[e(g,{style:{"margin-top":"16px"},color:"primary",onClick:U},{default:t(()=>[e(v,{class:"mr-2"},{default:t(()=>[o("mdi-backup-restore")]),_:1}),o(" "+s(r(_)("system.backup.button")),1)]),_:1})]),_:1},8,["subtitle","title"]),e(q,{subtitle:r(_)("system.restart.subtitle"),title:r(_)("system.restart.title")},{default:t(()=>[e(g,{style:{"margin-top":"16px"},color:"error",onClick:V},{default:t(()=>[o(s(r(_)("system.restart.button")),1)]),_:1})]),_:1},8,["subtitle","title"]),e(q,{subtitle:r(_)("system.migration.subtitle"),title:r(_)("system.migration.title")},{default:t(()=>[e(g,{style:{"margin-top":"16px"},color:"primary",onClick:z},{default:t(()=>[o(s(r(_)("system.migration.button")),1)]),_:1})]),_:1},8,["subtitle","title"])]),_:1})]),e(Le,{ref_key:"wfr",ref:l},null,512),e(bt,{ref_key:"migrationDialog",ref:w},null,512),e(fa,{ref_key:"backupDialog",ref:b},null,512)],64))}};export{Ca as default};

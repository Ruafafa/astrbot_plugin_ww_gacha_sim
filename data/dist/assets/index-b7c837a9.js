import{bl as V}from"./index-61371d60.js";const z=["jsx","tsx","vue","csharp","python","java","c","cpp","rust","go","powershell","sql","json","html","javascript","typescript","css","markdown","xml","yaml","toml","dockerfile","kotlin","objective-c","objective-cpp","php","ruby","scala","svelte","swift","erlang","angular-html","angular-ts","dart","lua","mermaid","cmake","nginx"],G=["vitesse-dark","vitesse-light"];let H=null,q=null;async function J(e={}){return H||(q||(q=(async()=>{const{createHighlighter:t}=await V(()=>import("./index-32b820be.js"),["assets/index-32b820be.js","assets/bundle-full-8cad1ef0.js","assets/index-61371d60.js","assets/index-aea99547.css"]);(!e.langs||e.langs.length===0)&&(e.langs=z),(!e.themes||e.themes.length===0)&&(e.themes=G);const r=await t({themes:e.themes,langs:e.langs});return H=r,r})().finally(()=>{q=null})),await q,H)}function ue(){H=null}function Q(e){return e.replace(/\r/g,"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function K(e){if(!e||e===0)return"";const t=[];return e&1&&t.push("font-style: italic;"),e&2&&t.push("font-weight: 600;"),e&4&&t.push("text-decoration: underline; text-underline-offset: 0.15em;"),t.join(" ")}function F(e,t,r){var b,g;const{lang:n,theme:s,preClass:l="shiki",codeClass:o="",lineClass:f="line",showLineNumbers:c=!1,startingLineNumber:a=1}=r;let u;const i=e;if(typeof i.codeToThemedTokens=="function")u=i.codeToThemedTokens(t,n,s);else if(typeof i.codeToTokens=="function")u=i.codeToTokens(t,{lang:n,theme:s}).tokens;else throw new TypeError("Highlighter does not support token APIs: codeToThemedTokens/codeToTokens");{const p=t.replace(/\r\n/g,`
`).split(`
`).length;u.length<p&&(u=u.concat(Array.from({length:p-u.length},()=>[])))}let h;try{h=(g=(b=e.getTheme)==null?void 0:b.call(e,s))==null?void 0:g.bg}catch{}let C=a;const m=u.map(p=>{const R=p.map(v=>{const x=`${v.color?`color: ${v.color};`:""}${K(v.fontStyle)}`;return`<span${x?` style="${x}"`:""}>${Q(v.content)}</span>`}).join("");return`<span class="${f}">${c?`<span class="line-number" data-line="${C++}"></span>`:""}${R}</span>`}).join(`
`);return`<pre class="${l}"${h?` style="background-color: ${h};"`:""}><code${o?` class="${o}"`:""}>${m}</code></pre>`}function X(e){const t=e;if(typeof t.codeToThemedTokens=="function")return(r,n,s)=>t.codeToThemedTokens(r,n,s);if(typeof t.codeToTokens=="function")return(r,n,s)=>t.codeToTokens(r,{lang:n,theme:s}).tokens;throw new Error("Highlighter does not support token APIs: codeToThemedTokens/codeToTokens")}function P(e){if(!e||e===0)return"";const t=[];return e&1&&t.push("font-style: italic;"),e&2&&t.push("font-weight: 600;"),e&4&&t.push("text-decoration: underline; text-underline-offset: 0.15em;"),t.join(" ")}function Y(e){return e.replace(/\r/g,"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Z(e,t,r){const n=e.map(s=>{const l=`${s.color?`color: ${s.color};`:""}${P(s.fontStyle)}`;return`<span${l?` style="${l}"`:""}>${Y(s.content)}</span>`}).join("");return`${t&&typeof r=="number"?`<span class="line-number" data-line="${r}"></span>`:""}${n}`}function A(e,t,r,n){const s=document.createElement("span");if(s.className=n,t&&typeof r=="number"){const o=document.createElement("span");o.className="line-number",o.dataset.line=String(r),s.appendChild(o)}let l=0;for(;l<e.length;){const o=e[l],f=`${o.color?`color: ${o.color};`:""}${P(o.fontStyle)}`;let c=o.content;for(l++;l<e.length;){const u=e[l];if(`${u.color?`color: ${u.color};`:""}${P(u.fontStyle)}`!==f)break;c+=u.content,l++}const a=document.createElement("span");f&&a.setAttribute("style",f),a.textContent=c,s.appendChild(a)}return s}function W(e,t,r,n){var x,T,S,$,N;if(!e)return"noop";const{lang:s,theme:l,preClass:o="shiki",codeClass:f="",lineClass:c="line",showLineNumbers:a=!1,startingLineNumber:u=1}=n,i=X(t),h=e.querySelector("code");if(!h)return e.innerHTML=F(t,r,{lang:s,theme:l,preClass:o,codeClass:f,lineClass:c,showLineNumbers:a,startingLineNumber:u}),(x=n.onResult)==null||x.call(n,"full"),"full";const C=h.querySelectorAll(`.${c}`);let m=i(r,s,l);{const d=r.replace(/\r\n/g,`
`).split(`
`).length;if(m.length<d){const k=d-m.length;m=m.concat(Array.from({length:k},()=>[]))}}const b=m.length,g=C.length;let p=-1;const R=Math.min(g,b);let v=u;for(let d=0;d<R;d++){const k=Z(m[d],a,a?v:void 0);if(C[d].innerHTML!==k){p=d;break}v++}if(p===-1){if(b>g){const d=document.createDocumentFragment();let k=u+g;for(let L=g;L<b;L++){d.appendChild(document.createTextNode(`
`));const I=A(m[L],a,a?k:void 0,c);d.appendChild(I),k++}return h.appendChild(d),(T=n.onResult)==null||T.call(n,"incremental"),"incremental"}return(S=n.onResult)==null||S.call(n,"noop"),"noop"}if(p>=g-1){const d=A(m[p],a,a?u+p:void 0,c);for(C[p].innerHTML="";d.firstChild;)C[p].appendChild(d.firstChild);if(b>g){const k=document.createDocumentFragment();let L=u+g;for(let I=g;I<b;I++){k.appendChild(document.createTextNode(`
`));const D=A(m[I],a,a?L:void 0,c);k.appendChild(D),L++}h.appendChild(k)}return($=n.onResult)==null||$.call(n,"incremental"),"incremental"}return e.innerHTML=F(t,r,{lang:s,theme:l,preClass:o,codeClass:f,lineClass:c,showLineNumbers:a,startingLineNumber:u}),(N=n.onResult)==null||N.call(n,"full"),"full"}function fe(e,t,r){let n=!0,s=e;return{update:l=>!n||!s?"noop":W(s,t,l,r),reset:()=>{!n||!s||(s.innerHTML="")},dispose:()=>{n=!1,s=null}}}var ee=class{constructor(){this.queue=[],this.byContainer=new WeakMap,this.visible=new WeakMap,this.io=null,this.handle=null,this.nextId=1;try{this.io=new IntersectionObserver(e=>{for(const t of e)this.visible.set(t.target,t.isIntersecting)},{root:null,threshold:0})}catch{this.io=null}}schedule(e,t,r,n){var o;const s=this.byContainer.get(e);if(s)return s.code=r,s.highlighter=t,s.opts=n,s.id;const l={id:this.nextId++,container:e,highlighter:t,code:r,opts:n};{const f=r.replace(/\r\n/g,`
`),c=1+(((o=f.match(/\n/g))==null?void 0:o.length)??0),a=Math.ceil(f.length/6);l.estNodes=Math.min(8e3,c+a)}return this.queue.push(l),this.byContainer.set(e,l),this.io&&this.io.observe(e),this.ensureProcessing(),l.id}ensureProcessing(){this.handle==null&&(this.handle=(window.requestIdleCallback||function(e){return setTimeout(()=>e({timeRemaining:()=>50,didTimeout:!0}),50)})(e=>this.process(e)))}process(e){var s,l,o,f,c,a;this.handle=null;const t=typeof(e==null?void 0:e.timeRemaining)=="function"?e.timeRemaining():50,r=Math.min(2e3,Math.max(100,Math.floor(t*6)));let n=0;for(;this.queue.length&&!(n>=r);){let u=this.queue.findIndex(h=>this.visible.get(h.container)===!0);u===-1&&(u=0);const i=this.queue.splice(u,1)[0];if(this.byContainer.delete(i.container),typeof i.estNodes=="number"&&n+i.estNodes>r&&n!==0){this.queue.push(i),this.byContainer.set(i.container,i);break}try{const h=W(i.container,i.highlighter,i.code,i.opts);(l=(s=i.opts).onResult)==null||l.call(s,h),typeof i.estNodes=="number"?n+=i.estNodes:n+=50}catch{try{i.container.innerHTML=F(i.highlighter,i.code,{lang:i.opts.lang,theme:i.opts.theme,preClass:i.opts.preClass,codeClass:i.opts.codeClass,lineClass:i.opts.lineClass,showLineNumbers:i.opts.showLineNumbers,startingLineNumber:i.opts.startingLineNumber}),(f=(o=i.opts).onResult)==null||f.call(o,"full")}catch{(a=(c=i.opts).onResult)==null||a.call(c,"noop")}}if(typeof(e==null?void 0:e.timeRemaining)=="function"&&e.timeRemaining()<6)break}this.queue.length&&this.ensureProcessing()}cancelFor(e){const t=this.byContainer.get(e);if(!t)return;this.byContainer.delete(e);const r=this.queue.findIndex(n=>n.id===t.id);r!==-1&&this.queue.splice(r,1),this.io&&this.io.unobserve(e),this.visible.delete(e)}};const E=new ee;function te(e,t,r){let n=!0,s=!1;return{update:l=>(!n||!e||(E.schedule(e,t,l,r),s=!0),"noop"),reset:()=>{!n||!e||(E.cancelFor(e),e.innerHTML="")},dispose:()=>{n=!1,s&&e&&E.cancelFor(e)}}}const y=[];let w=null,M=!1,O=8;function ne(e){typeof e=="number"&&e>=0&&(O=e)}function he(){return O}function de(){return M}function me(){return y.length}function re(){M=!0}function se(){M&&(M=!1,U())}function U(){w==null&&(M||(w=requestAnimationFrame(ie)))}function ie(){w=null;const e=performance.now();for(;y.length>0;){const t=y.shift();try{t()}catch(r){console.error("render-scheduler job error",r)}if(performance.now()-e>=O)break}y.length>0&&U()}function _(e,t){((t==null?void 0:t.priority)??"normal")==="high"?y.unshift(e):y.push(e),U();let r=!1;return()=>{if(r)return;r=!0;const n=y.indexOf(e);n>=0&&y.splice(n,1)}}function ge(e){e()}function le(){for(w!=null&&(cancelAnimationFrame(w),w=null);y.length>0;){const e=y.shift();try{e()}catch{}}}function pe(){y.length=0,w!=null&&(cancelAnimationFrame(w),w=null)}function be(e,t={}){const r=Math.max(1,t.batchSize??6),n=Math.max(1,t.staggerMs??30),s=[],l=[];for(const c of e){const a=c.el.getBoundingClientRect(),u=globalThis.innerHeight??0;a.bottom>=0&&a.top<=u?s.push(c):l.push(c)}re();for(const c of s)_(()=>{try{c.render()}catch{}},{priority:"high"});se(),t.drainVisible&&le();let o=!1;const f=[];for(let c=0;c<l.length;c+=r){const a=l.slice(c,c+r),u=Math.floor(c/r)*n,i=setTimeout(()=>{if(!o)for(const h of a)_(()=>{try{h.render()}catch{}},{priority:"normal"})},u);f.push(i)}return()=>{o=!0;for(const c of f)clearTimeout(c)}}const B=new WeakMap;let j=null;function oe(){return j||(typeof window>"u"||!window.IntersectionObserver?null:(j=new IntersectionObserver(e=>{for(const t of e){const r=B.get(t.target);if(r)try{r(!!t.isIntersecting,t)}catch{}}},{root:null,threshold:0}),j))}function ce(e,t){const r=oe();return B.set(e,t),r&&r.observe(e),()=>{B.delete(e),r&&r.unobserve(e)}}function Te(e,t){let r="",n=t.lang,s=t.theme??"vitesse-dark",l=null,o=null;const f=t.scheduleInRaf??!0;let c=!1,a=null,u=!1,i=null,h=!1;const C=()=>{a!=null&&(cancelAnimationFrame(a),a=null)},m=async()=>{l=await J({langs:t.langs,themes:t.themes})};typeof window<"u"&&e&&(i=ce(e,T=>{h=T})),typeof t.timeBudget=="number"&&t.timeBudget>=0&&ne(t.timeBudget);const b=()=>{o==null||o.dispose(),o=te(e,l,{lang:n??"plaintext",theme:s})},g=()=>{if(!u&&!c){if(!f){if(!o)return;o.update(r);return}c||(c=!0,_(()=>{c=!1,o&&o.update(r)},{priority:h?"high":"normal"}),a=null)}};return{updateCode:async(T,S)=>{const $=S??n,N=$!==n;r=T,!l||N?(n=$,await m(),b()):o||b(),g()},setTheme:async T=>{T&&T!==s&&(s=T,l?l.loadTheme(T):await m(),b(),g())},dispose:()=>{o==null||o.dispose(),o=null,i&&(i(),i=null),u=!0,C()},getState:()=>({code:r,lang:n,theme:s})}}export{pe as clearAll,te as createScheduledTokenIncrementalUpdater,Te as createShikiStreamRenderer,fe as createTokenIncrementalUpdater,z as defaultLanguages,G as defaultThemes,ue as disposeHighlighter,le as drain,me as getQueueLength,he as getTimeBudget,de as isPaused,re as pause,J as registerHighlight,F as renderCodeWithTokens,be as restoreWithVisibilityPriority,se as resume,ge as runImmediate,_ as scheduleRenderJob,ne as setTimeBudget,W as updateCodeTokensIncremental};

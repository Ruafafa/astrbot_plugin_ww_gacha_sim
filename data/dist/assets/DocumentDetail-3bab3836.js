import{T as ee,ae as te,W as ae,v as r,c as le,M as se,o as D,g as z,A as s,b as e,B as V,t as l,f as u,E as ne,w as t,z as $,e as d,a3 as w,C as M,al as oe,am as y,l as _,y as N,k as P,I as U,a2 as ie,D as de,aH as ue,p as ce,O as re,V as A,d as K,q,H as me,J as _e,ak as ve,K as E}from"./index-61371d60.js";import{_ as he}from"./_plugin-vue_export-helper-c27b6911.js";const fe={class:"document-detail-page"},pe={class:"page-header"},ke={class:"header-content"},xe={class:"text-h4"},ge={class:"text-subtitle-1 text-medium-emphasis mt-2"},Ve={key:0,class:"loading-container"},we={key:1,class:"document-content"},ye={class:"info-item"},Ce={class:"text-caption text-medium-emphasis"},be={class:"text-body-1"},De={class:"info-item"},ze={class:"text-caption text-medium-emphasis"},Ie={class:"text-body-1"},Be={class:"info-item"},Se={class:"text-caption text-medium-emphasis"},Fe={class:"text-body-1"},Le={class:"info-item"},$e={class:"text-caption text-medium-emphasis"},Me={class:"text-body-1"},Ne={class:"info-item"},Pe={class:"text-caption text-medium-emphasis"},Ue={class:"text-body-1"},Ae={class:"chunk-content-preview"},Ke={class:"text-center py-8"},qe={class:"mt-4 text-medium-emphasis"},Ee={key:0,class:"pa-4 d-flex align-center justify-space-between"},He={class:"text-caption text-medium-emphasis"},Re={class:"d-flex align-center gap-2"},je={class:"text-caption text-medium-emphasis mb-2"},Ge={class:"chunk-content-view"},Je=ee({__name:"DocumentDetail",setup(Oe){const{tm:i}=te("features/knowledge-base/document"),H=ae(),C=r(H.params.kbId),I=r(H.params.docId),B=r(!0),S=r(!1),m=r({}),F=r([]),L=r(""),k=r(!1),x=r(null),h=r(1),v=r(10),p=r(0),f=r({show:!1,text:"",color:"success"}),g=(a,n="success")=>{f.value.text=a,f.value.color=n,f.value.show=!0},R=[{title:i("chunks.index"),key:"chunk_index",width:100},{title:i("chunks.content"),key:"content",sortable:!1},{title:i("chunks.charCount"),key:"char_count",width:150},{title:i("chunks.actions"),key:"actions",sortable:!1,width:150}],j=le(()=>{if(!L.value)return F.value;const a=L.value.toLowerCase();return F.value.filter(n=>n.content.toLowerCase().includes(a))}),G=async()=>{B.value=!0;try{const a=await E.get("/api/kb/document/get",{params:{doc_id:I.value,kb_id:C.value}});a.data.status==="ok"&&(m.value=a.data.data)}catch(a){console.error("Failed to load document:",a),g("加载文档详情失败","error")}finally{B.value=!1}},b=async()=>{S.value=!0;try{const a=await E.get("/api/kb/chunk/list",{params:{doc_id:I.value,kb_id:C.value,page:h.value,page_size:v.value}});a.data.status==="ok"&&(F.value=a.data.data.items||[],p.value=a.data.data.total||0)}catch(a){console.error("Failed to load chunks:",a),g("加载分块列表失败","error")}finally{S.value=!1}},J=a=>{h.value=a,b()},O=a=>{v.value=a,h.value=1,b()},Q=a=>{x.value=a,k.value=!0},W=async a=>{if(confirm(i("chunks.deleteConfirm")))try{(await E.post("/api/kb/chunk/delete",{chunk_id:a.chunk_id,doc_id:I.value,kb_id:C.value})).data.status==="ok"?(g(i("chunks.deleteSuccess")),b()):g(i("chunks.deleteFailed"),"error")}catch(n){console.error("Failed to delete chunk:",n),g(i("chunks.deleteFailed"),"error")}},X=a=>{const n=(a==null?void 0:a.toLowerCase())||"";return n.includes("pdf")?"mdi-file-pdf-box":n.includes("md")?"mdi-language-markdown":n.includes("txt")?"mdi-file-document-outline":"mdi-file"},Y=a=>{const n=(a==null?void 0:a.toLowerCase())||"";return n.includes("pdf")?"error":n.includes("md")?"info":n.includes("txt")?"success":"grey"},Z=a=>{if(!a)return"-";const n=["B","KB","MB","GB"];let o=a,c=0;for(;o>=1024&&c<n.length-1;)o/=1024,c++;return`${o.toFixed(2)} ${n[c]}`},T=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return se(()=>{G(),b()}),(a,n)=>(D(),z("div",fe,[s("div",pe,[e(V,{icon:"mdi-arrow-left",variant:"text",onClick:n[0]||(n[0]=o=>a.$router.push({name:"NativeKBDetail",params:{kbId:C.value}}))}),s("div",ke,[s("h1",xe,l(m.value.doc_name),1),s("p",ge,l(u(i)("title")),1)])]),B.value?(D(),z("div",Ve,[e(ne,{indeterminate:"",color:"primary",size:"64"})])):(D(),z("div",we,[e(N,{elevation:"2",class:"mb-6"},{default:t(()=>[e($,null,{default:t(()=>[d(l(u(i)("info.title")),1)]),_:1}),e(w),e(M,null,{default:t(()=>[e(oe,null,{default:t(()=>[e(y,{cols:"12",md:"3"},{default:t(()=>[s("div",ye,[e(_,{start:""},{default:t(()=>[d("mdi-label")]),_:1}),s("div",null,[s("div",Ce,l(u(i)("info.name")),1),s("div",be,l(m.value.doc_name),1)])])]),_:1}),e(y,{cols:"12",md:"2"},{default:t(()=>[s("div",De,[e(_,{start:"",color:Y(m.value.file_type)},{default:t(()=>[d(l(X(m.value.file_type)),1)]),_:1},8,["color"]),s("div",null,[s("div",ze,l(u(i)("info.type")),1),s("div",Ie,l(m.value.file_type||"-"),1)])])]),_:1}),e(y,{cols:"12",md:"2"},{default:t(()=>[s("div",Be,[e(_,{start:""},{default:t(()=>[d("mdi-file-chart")]),_:1}),s("div",null,[s("div",Se,l(u(i)("info.size")),1),s("div",Fe,l(Z(m.value.file_size)),1)])])]),_:1}),e(y,{cols:"12",md:"2"},{default:t(()=>[s("div",Le,[e(_,{start:""},{default:t(()=>[d("mdi-text-box")]),_:1}),s("div",null,[s("div",$e,l(u(i)("info.chunkCount")),1),s("div",Me,l(m.value.chunk_count||0),1)])])]),_:1}),e(y,{cols:"12",md:"3"},{default:t(()=>[s("div",Ne,[e(_,{start:""},{default:t(()=>[d("mdi-calendar")]),_:1}),s("div",null,[s("div",Pe,l(u(i)("info.createdAt")),1),s("div",Ue,l(T(m.value.created_at)),1)])])]),_:1})]),_:1})]),_:1})]),_:1}),e(N,{elevation:"2"},{default:t(()=>[e($,{class:"d-flex align-center pa-4"},{default:t(()=>[s("span",null,l(u(i)("chunks.title")),1),e(P,{class:"ml-2",size:"small",variant:"tonal"},{default:t(()=>[d(l(p.value)+" "+l(u(i)("chunks.title")),1)]),_:1}),e(U)]),_:1}),e(w),e(M,{class:"pa-0"},{default:t(()=>[e(ie,{headers:R,items:j.value,loading:S.value,"items-per-page":v.value,"hide-default-footer":""},{"item.chunk_index":t(({item:o})=>[e(P,{size:"small",variant:"tonal",color:"primary"},{default:t(()=>[d(" #"+l(o.chunk_index+1),1)]),_:2},1024)]),"item.content":t(({item:o})=>[s("div",Ae,l(o.content),1)]),"item.char_count":t(({item:o})=>[e(P,{size:"small",variant:"outlined"},{default:t(()=>[d(l(o.char_count)+" 字符 ",1)]),_:2},1024)]),"item.actions":t(({item:o})=>[e(V,{icon:"mdi-eye",variant:"text",size:"small",color:"info",onClick:c=>Q(o)},null,8,["onClick"]),e(V,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:c=>W(o)},null,8,["onClick"])]),"no-data":t(()=>[s("div",Ke,[e(_,{size:"64",color:"grey-lighten-2"},{default:t(()=>[d("mdi-text-box-outline")]),_:1}),s("p",qe,l(u(i)("chunks.empty")),1)])]),_:1},8,["items","loading","items-per-page"]),!L.value&&p.value>0?(D(),z("div",Ee,[s("div",He,l(u(i)("chunks.showing"))+" "+l((h.value-1)*v.value+1)+" - "+l(Math.min(h.value*v.value,p.value))+" / "+l(p.value),1),s("div",Re,[e(de,{modelValue:v.value,"onUpdate:modelValue":[n[1]||(n[1]=o=>v.value=o),O],items:[10,25,50,100],density:"compact",variant:"outlined","hide-details":"",style:{width:"100px"}},null,8,["modelValue"]),e(ue,{modelValue:h.value,"onUpdate:modelValue":[n[2]||(n[2]=o=>h.value=o),J],length:Math.ceil(p.value/v.value),"total-visible":5},null,8,["modelValue","length"])])])):ce("",!0)]),_:1})]),_:1})])),e(_e,{modelValue:k.value,"onUpdate:modelValue":n[5]||(n[5]=o=>k.value=o),"max-width":"800px",scrollable:""},{default:t(()=>[e(N,null,{default:t(()=>[e($,{class:"pa-4"},{default:t(()=>[s("span",null,l(u(i)("view.title")),1),e(U),e(V,{icon:"mdi-close",variant:"text",onClick:n[3]||(n[3]=o=>k.value=!1)})]),_:1}),e(w),e(M,{class:"pa-6"},{default:t(()=>{var o;return[e(re,{density:"comfortable"},{default:t(()=>[e(A,null,{prepend:t(()=>[e(_,null,{default:t(()=>[d("mdi-pound")]),_:1})]),default:t(()=>[e(K,null,{default:t(()=>[d(l(u(i)("view.index")),1)]),_:1}),e(q,null,{default:t(()=>{var c;return[d("#"+l((((c=x.value)==null?void 0:c.chunk_index)||0)+1),1)]}),_:1})]),_:1}),e(A,null,{prepend:t(()=>[e(_,null,{default:t(()=>[d("mdi-text")]),_:1})]),default:t(()=>[e(K,null,{default:t(()=>[d(l(u(i)("view.charCount")),1)]),_:1}),e(q,null,{default:t(()=>{var c;return[d(l(((c=x.value)==null?void 0:c.char_count)||0)+" 字符",1)]}),_:1})]),_:1}),e(A,null,{prepend:t(()=>[e(_,null,{default:t(()=>[d("mdi-key")]),_:1})]),default:t(()=>[e(K,null,{default:t(()=>[d(l(u(i)("view.vecDocId")),1)]),_:1}),e(q,null,{default:t(()=>{var c;return[d(l(((c=x.value)==null?void 0:c.chunk_id)||"-"),1)]}),_:1})]),_:1})]),_:1}),e(w,{class:"my-4"}),s("div",je,l(u(i)("view.content")),1),s("div",Ge,l((o=x.value)==null?void 0:o.content),1)]}),_:1}),e(w),e(me,{class:"pa-4"},{default:t(()=>[e(U),e(V,{variant:"text",onClick:n[4]||(n[4]=o=>k.value=!1)},{default:t(()=>[d(l(u(i)("view.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ve,{modelValue:f.value.show,"onUpdate:modelValue":n[6]||(n[6]=o=>f.value.show=o),color:f.value.color},{default:t(()=>[d(l(f.value.text),1)]),_:1},8,["modelValue","color"])]))}});const Xe=he(Je,[["__scopeId","data-v-006c7d6c"]]);export{Xe as default};

import{u as oe,ae as Y,v as L,o as l,g as v,a as S,w as a,C as q,b as t,d as ce,e as _,t as c,q as de,p as b,F as U,h as P,al as ge,am as ee,V as fe,A as d,k as Ae,a3 as ae,y as z,aL as ue,B as I,l as ne,aM as me,f as y,I as he,aN as _e,J as G,c as ie,R as pe,S as ve,r as X,aE as Le,aD as Ue,$ as Re,a0 as je,_ as Be,aO as ze,s as Oe,aP as Ne,n as Pe,T as qe,M as Ke,aQ as We,z as Ce,K as j,aR as Je,D as Xe,Y as Ye,aA as Ge,ak as He,aj as Qe,ap as te,m as se,O as Ze,j as Me,a5 as $e}from"./index-61371d60.js";import{V as ye}from"./index-2a23493b.js";import{T as et,C as tt,u as st}from"./AstrBotConfig-27eff76a.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";import{W as at}from"./WaitingForRestart-d6ba996f.js";import{useCustomizerStore as nt}from"./customizer-e056107a.js";import{M as it}from"./MessageList-fbdd7c7f.js";import{u as ot,a as lt,b as rt,C as ct}from"./useRecording-073e8009.js";const dt=e=>(pe("data-v-5300b607"),e=e(),ve(),e),gt={key:0,class:"important-hint"},ft={key:1,class:"object-config"},ut={class:"property-key"},mt={key:0,class:"important-hint"},ht={key:0,class:"selected-plugins-full-width"},_t=dt(()=>d("div",{class:"plugins-header"},[d("small",{class:"text-grey"},"å·²é€‰æ‹©çš„æ’ä»¶ï¼š")],-1)),pt={class:"d-flex flex-wrap ga-2 mt-2"},vt={__name:"AstrBotConfigV4",props:{metadata:{type:Object,required:!0},iterable:{type:Object,required:!0},metadataKey:{type:String,required:!0}},setup(e){const s=e,{t:h}=oe(),{tm:o,getRaw:i}=Y("features/config-metadata"),g=f=>!f||typeof f!="string"?f:o(f),T=L(!1),w=L(""),E=L("json"),D=L("vs-light");let r=null;function V(f,C){const p=C.split(".");let u=f;for(const n of p)if(u&&typeof u=="object"&&n in u)u=u[n];else return;return u}function K(f,C,p){const u=C.split(".");let n=f;for(let m=0;m<u.length-1;m++){const F=u[m];(!n[F]||typeof n[F]!="object")&&(n[F]={}),n=n[F]}n[u[u.length-1]]=p}function R(f){return ie({get(){return V(s.iterable,f)},set(C){K(s.iterable,f,C)}})}function Q(f,C,p,u){w.value=f,E.value=u||"json",D.value=p||"vs-light",r=C,T.value=!0}function Z(){T.value=!1}function W(f,C){if(!(f!=null&&f.condition))return!0;for(const[p,u]of Object.entries(f.condition))if(V(s.iterable,p)!==u)return!1;return!0}function M(){const f=s.metadata[s.metadataKey];if(!(f!=null&&f.condition))return!0;for(const[C,p]of Object.entries(f.condition))if(V(s.iterable,C)!==p)return!1;return!0}function $(f,C){const p=Object.entries(f);for(let u=C+1;u<p.length;u++){const[n,m]=p[u];if(W(m))return!0}return!1}return(f,C)=>(l(),v(U,null,[M()?(l(),S(z,{key:0,style:{"margin-bottom":"16px","padding-bottom":"8px","background-color":"rgb(var(--v-theme-background))"},rounded:"md",variant:"outlined"},{default:a(()=>{var p,u;return[((p=e.metadata[e.metadataKey])==null?void 0:p.type)==="object"?(l(),S(q,{key:0,class:"config-section",style:{"padding-bottom":"8px"}},{default:a(()=>[t(ce,{class:"config-title"},{default:a(()=>{var n;return[_(c(g((n=e.metadata[e.metadataKey])==null?void 0:n.description)),1)]}),_:1}),t(de,{class:"config-hint"},{default:a(()=>{var n,m,F;return[(n=e.metadata[e.metadataKey])!=null&&n.obvious_hint&&((m=e.metadata[e.metadataKey])!=null&&m.hint)?(l(),v("span",gt,"â€¼ï¸")):b("",!0),_(" "+c(g((F=e.metadata[e.metadataKey])==null?void 0:F.hint)),1)]}),_:1})]),_:1})):b("",!0),((u=e.metadata[e.metadataKey])==null?void 0:u.type)==="object"?(l(),v("div",ft,[(l(!0),v(U,null,P(e.metadata[e.metadataKey].items,(n,m,F)=>(l(),v("div",{key:m,class:"config-item"},[W(n,m)?(l(),v(U,{key:0},[n!=null&&n.invisible?b("",!0):(l(),S(ge,{key:0,class:"config-row"},{default:a(()=>[t(ee,{cols:"12",sm:"6",class:"property-info"},{default:a(()=>[t(fe,{density:"compact"},{default:a(()=>[t(ce,{class:"property-name"},{default:a(()=>[_(c(g(n==null?void 0:n.description)||m)+" ",1),d("span",ut,"("+c(m)+")",1)]),_:2},1024),t(de,{class:"property-hint"},{default:a(()=>[n!=null&&n.obvious_hint&&(n!=null&&n.hint)?(l(),v("span",mt,"â€¼ï¸")):b("",!0),_(" "+c(g(n==null?void 0:n.hint)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(ee,{cols:"12",sm:"6",class:"config-input"},{default:a(()=>[(n==null?void 0:n.type)==="template_list"?(l(),S(et,{key:0,modelValue:R(m).value,"onUpdate:modelValue":A=>R(m).value=A,templates:(n==null?void 0:n.templates)||{},class:"config-field"},null,8,["modelValue","onUpdate:modelValue","templates"])):(l(),S(tt,{key:1,modelValue:R(m).value,"onUpdate:modelValue":A=>R(m).value=A,"item-meta":n||null,"show-fullscreen-btn":!!(n!=null&&n.editor_mode),onOpenFullscreen:A=>Q(m,e.iterable,n==null?void 0:n.editor_theme,n==null?void 0:n.editor_language)},null,8,["modelValue","onUpdate:modelValue","item-meta","show-fullscreen-btn","onOpenFullscreen"]))]),_:2},1024)]),_:2},1024)),!(n!=null&&n.invisible)&&(n==null?void 0:n._special)==="select_plugin_set"?(l(),S(ge,{key:1,class:"plugin-set-display-row"},{default:a(()=>[t(ee,{cols:"12",class:"plugin-set-display"},{default:a(()=>[R(m).value&&R(m).value.length>0?(l(),v("div",ht,[_t,d("div",pt,[(l(!0),v(U,null,P(R(m).value||[],A=>(l(),S(Ae,{key:A,size:"small",label:"",color:"primary",variant:"outlined"},{default:a(()=>[_(c(A==="*"?"æ‰€æœ‰æ’ä»¶":A),1)]),_:2},1024))),128))])])):b("",!0)]),_:2},1024)]),_:2},1024)):b("",!0)],64)):b("",!0),W(n,m)&&$(e.metadata[e.metadataKey].items,F)?(l(),S(ae,{key:1,class:"config-divider"})):b("",!0)]))),128))])):b("",!0)]}),_:1})):b("",!0),t(G,{modelValue:T.value,"onUpdate:modelValue":C[2]||(C[2]=p=>T.value=p),fullscreen:"",transition:"dialog-bottom-transition",scrollable:""},{default:a(()=>[t(z,null,{default:a(()=>[t(ue,{color:"primary",dark:""},{default:a(()=>[t(I,{icon:"",onClick:C[0]||(C[0]=p=>T.value=!1)},{default:a(()=>[t(ne,null,{default:a(()=>[_("mdi-close")]),_:1})]),_:1}),t(me,null,{default:a(()=>[_(c(y(h)("core.common.editor.editingTitle"))+" - "+c(w.value),1)]),_:1}),t(he),t(_e,null,{default:a(()=>[t(I,{variant:"text",onClick:Z},{default:a(()=>[_(c(y(h)("core.common.save")),1)]),_:1})]),_:1})]),_:1}),t(q,{class:"pa-0"},{default:a(()=>[t(y(ye),{theme:D.value,language:E.value,style:{height:"calc(100vh - 64px)"},value:y(r)[w.value],"onUpdate:value":C[1]||(C[1]=p=>y(r)[w.value]=p)},null,8,["theme","language","value"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Ct=H(vt,[["__scopeId","data-v-5300b607"]]);const yt={name:"AstrBotCoreConfigWrapper",components:{AstrBotConfigV4:Ct},props:{metadata:{type:Object,required:!0,default:()=>({})},config_data:{type:Object,required:!0,default:()=>({})},readonly:{type:Boolean,default:!1}},setup(){const{tm:e}=Y("features/config"),{tm:s}=Y("features/config-metadata");return{tm:o=>{const i=s(o);return!i.startsWith("[MISSING:")&&!i.startsWith("[INVALID:")?i:e(o)}}},data(){return{tab:0}},methods:{}},It={style:{"margin-left":"16px","padding-bottom":"16px"}},bt={href:"https://astrbot.app/",target:"_blank"},kt={href:"https://qm.qq.com/cgi-bin/qm/qr?k=EYGsuUTfe00_iOu9JTXS7_TEpMkXOvwv&jump_from=webapi&authKey=uUEMKCROfsseS+8IzqPjzV3y1tzy4AkykwTib2jNkOFdzezF9s9XknqnIaf3CDft",target:"_blank"};function St(e,s,h,o,i,g){const T=X("AstrBotConfigV4");return l(),v("div",{class:Pe(e.$vuetify.display.mobile?"":"d-flex")},[t(Ue,{modelValue:i.tab,"onUpdate:modelValue":s[0]||(s[0]=w=>i.tab=w),direction:e.$vuetify.display.mobile?"horizontal":"vertical","align-tabs":e.$vuetify.display.mobile?"left":"start",color:"deep-purple-accent-4",class:"config-tabs"},{default:a(()=>[(l(!0),v(U,null,P(h.metadata,(w,E,D)=>(l(),S(Le,{key:D,value:D,style:{"font-weight":"1000","font-size":"15px"}},{default:a(()=>[_(c(o.tm(h.metadata[E].name)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","direction","align-tabs"]),t(Ne,{modelValue:i.tab,"onUpdate:modelValue":s[1]||(s[1]=w=>i.tab=w),class:"config-tabs-window",style:Oe(h.readonly?"pointer-events: none; opacity: 0.6;":"")},{default:a(()=>[(l(!0),v(U,null,P(h.metadata,(w,E,D)=>Re((l(),S(ze,{key:D},{default:a(()=>[t(Be,{fluid:""},{default:a(()=>[(l(!0),v(U,null,P(h.metadata[E].metadata,(r,V,K)=>(l(),v("div",{key:V},[t(T,{metadata:{[V]:h.metadata[E].metadata[V]},iterable:h.config_data,metadataKey:V},null,8,["metadata","iterable","metadataKey"])]))),128))]),_:2},1024)]),_:2},1024)),[[je,D==i.tab]])),128)),d("div",It,[d("small",null,[_(c(o.tm("help.helpPrefix"))+" ",1),d("a",bt,c(o.tm("help.documentation")),1),_(" "+c(o.tm("help.helpMiddle"))+" ",1),d("a",kt,c(o.tm("help.support")),1),_(c(o.tm("help.helpSuffix")),1)])])]),_:1},8,["modelValue","style"])],2)}const Vt=H(yt,[["render",St]]),xt=e=>(pe("data-v-e6f96543"),e=e(),ve(),e),wt={class:"chat-layout"},Dt={class:"chat-content-panel"},Tt={key:1,class:"welcome-container fade-in"},Et=xt(()=>d("div",{class:"welcome-title"},[d("span",null,"Hello, I'm"),d("span",{class:"bot-name"},"AstrBot â­")],-1)),Ft={class:"text-caption text-medium-emphasis mt-2"},At=["src"],Lt=qe({__name:"StandaloneChat",props:{configId:{default:null}},setup(e){const{t:s}=oe(),{error:h}=st(),o=L(!1),i=L(""),g=L(""),T=ie(()=>null);async function w(){try{const x=(await j.get("/api/chat/new_session")).data.data.session_id;return g.value=x,x}catch(k){throw console.error(k),k}}function E(k,x){}function D(){}const{stagedImagesUrl:r,stagedAudioUrl:V,stagedFiles:K,getMediaFile:R,processAndUploadImage:Q,handlePaste:Z,removeImage:W,removeAudio:M,clearStaged:$,cleanupMediaCache:f}=ot(),{isRecording:C,startRecording:p,stopRecording:u}=lt(),{messages:n,isStreaming:m,isConvRunning:F,enableStreaming:A,getSessionMessages:es,sendMessage:Ie,toggleStreaming:be}=rt(g,R,E,D),le=L(null),re=L(null),J=L(""),ke=ie(()=>nt().uiTheme==="PurpleThemeDark");function Se(k){i.value=k,o.value=!0}async function Ve(){await p()}async function xe(){const k=await u();V.value=k}async function we(k){for(const x of k)await Q(x)}async function De(){var k;if(!(!J.value.trim()&&K.value.length===0&&!V.value))try{g.value||await w();const x=J.value.trim(),O=V.value,Te=K.value.map(B=>({attachment_id:B.attachment_id,url:B.url,original_name:B.original_name,type:B.type}));J.value="",$();const N=(k=re.value)==null?void 0:k.getCurrentSelection(),Ee=(N==null?void 0:N.providerId)||"",Fe=(N==null?void 0:N.modelName)||"";await Ie(x,Te,O,Ee,Fe),Je(()=>{var B;(B=le.value)==null||B.scrollToBottom()})}catch(x){console.error("Failed to send message:",x),h(s("features.chat.errors.sendMessageFailed"))}}return Ke(async()=>{try{await w()}catch(k){console.error("Failed to create initial session:",k),h(s("features.chat.errors.createSessionFailed"))}}),We(()=>{f()}),(k,x)=>(l(),v(U,null,[t(z,{class:"standalone-chat-card",elevation:"0",rounded:"0"},{default:a(()=>[t(q,{class:"standalone-chat-container"},{default:a(()=>[d("div",wt,[d("div",Dt,[y(n)&&y(n).length>0?(l(),S(it,{key:0,messages:y(n),isDark:ke.value,isStreaming:y(m)||y(F),onOpenImagePreview:Se,ref_key:"messageList",ref:le},null,8,["messages","isDark","isStreaming"])):(l(),v("div",Tt,[Et,d("p",Ft," æµ‹è¯•é…ç½®: "+c(k.configId||"default"),1)])),t(ct,{prompt:J.value,"onUpdate:prompt":x[0]||(x[0]=O=>J.value=O),stagedImagesUrl:y(r),stagedAudioUrl:y(V),disabled:y(m),enableStreaming:y(A),isRecording:y(C),"session-id":g.value||null,"current-session":T.value,"config-id":k.configId,onSend:De,onToggleStreaming:y(be),onRemoveImage:y(W),onRemoveAudio:y(M),onStartRecording:Ve,onStopRecording:xe,onPasteImage:y(Z),onFileSelect:we,ref_key:"chatInputRef",ref:re},null,8,["prompt","stagedImagesUrl","stagedAudioUrl","disabled","enableStreaming","isRecording","session-id","current-session","config-id","onToggleStreaming","onRemoveImage","onRemoveAudio","onPasteImage"])])])]),_:1})]),_:1}),t(G,{modelValue:o.value,"onUpdate:modelValue":x[2]||(x[2]=O=>o.value=O),"max-width":"90vw","max-height":"90vh"},{default:a(()=>[t(z,{class:"image-preview-card",elevation:"8"},{default:a(()=>[t(Ce,{class:"d-flex justify-space-between align-center pa-4"},{default:a(()=>[d("span",null,c(y(s)("core.common.imagePreview")),1),t(I,{icon:"mdi-close",variant:"text",onClick:x[1]||(x[1]=O=>o.value=!1)})]),_:1}),t(q,{class:"text-center pa-4"},{default:a(()=>[d("img",{src:i.value,class:"preview-image-large"},null,8,At)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});const Ut=H(Lt,[["__scopeId","data-v-e6f96543"]]);const Rt={name:"ConfigPage",components:{AstrBotCoreConfigWrapper:Vt,VueMonacoEditor:ye,WaitingForRestart:at,StandaloneChat:Ut},props:{initialConfigId:{type:String,default:null}},setup(){const{t:e}=oe(),{tm:s}=Y("features/config");return{t:e,tm:s}},computed:{messages(){return{loadError:this.tm("messages.loadError"),saveSuccess:this.tm("messages.saveSuccess"),saveError:this.tm("messages.saveError"),configApplied:this.tm("messages.configApplied"),configApplyError:this.tm("messages.configApplyError")}},configInfoNameList(){return this.configInfoList.map(e=>e.name)},selectedConfigInfo(){return this.configInfoList.find(e=>e.id===this.selectedConfigID)||{}},configSelectItems(){const e=[...this.configInfoList];return e.push({id:"_%manage%_",name:this.tm("configManagement.manageConfigs"),umop:[]}),e}},watch:{config_data_str(e){this.config_data_has_changed=!0},initialConfigId(e){e&&this.selectedConfigID!==e&&this.getConfigInfoList(e)}},data(){return{codeEditorDialog:!1,configManageDialog:!1,showConfigForm:!1,isEditingConfig:!1,config_data_has_changed:!1,config_data_str:"",config_data:{config:{}},fetched:!1,metadata:{},save_message_snack:!1,save_message:"",save_message_success:"",configContentKey:0,configType:"normal",isSystemConfig:!1,selectedConfigID:null,configInfoList:[],configFormData:{name:""},editingConfigId:null,testChatDrawer:!1,testConfigId:null}},mounted(){const e=this.initialConfigId||"default";this.getConfigInfoList(e),this.configType=this.isSystemConfig?"system":"normal"},methods:{getConfigInfoList(e){j.get("/api/config/abconfs").then(s=>{if(this.configInfoList=s.data.data.info_list,e){let h=!1;for(let o=0;o<this.configInfoList.length;o++)if(this.configInfoList[o].id===e){this.selectedConfigID=this.configInfoList[o].id,this.getConfig(e),h=!0;break}!h&&this.configInfoList.length&&(this.selectedConfigID=this.configInfoList[0].id,this.getConfig(this.selectedConfigID))}}).catch(s=>{this.save_message=this.messages.loadError,this.save_message_snack=!0,this.save_message_success="error"})},getConfig(e){this.fetched=!1;const s={};this.isSystemConfig?s.system_config="1":s.id=e||this.selectedConfigID,j.get("/api/config/abconf",{params:s}).then(h=>{this.config_data=h.data.data.config,this.fetched=!0,this.metadata=h.data.data.metadata,this.configContentKey+=1}).catch(h=>{this.save_message=this.messages.loadError,this.save_message_snack=!0,this.save_message_success="error"})},updateConfig(){if(!this.fetched)return;const e={config:JSON.parse(JSON.stringify(this.config_data))};this.isSystemConfig?e.conf_id="default":e.conf_id=this.selectedConfigID,j.post("/api/config/astrbot/update",e).then(s=>{s.data.status==="ok"?(this.save_message=s.data.message||this.messages.saveSuccess,this.save_message_snack=!0,this.save_message_success="success",this.isSystemConfig&&j.post("/api/stat/restart-core").then(()=>{this.$refs.wfr.check()})):(this.save_message=s.data.message||this.messages.saveError,this.save_message_snack=!0,this.save_message_success="error")}).catch(s=>{this.save_message=this.messages.saveError,this.save_message_snack=!0,this.save_message_success="error"})},configToString(){this.config_data_str=JSON.stringify(this.config_data,null,2),this.config_data_has_changed=!1},applyStrConfig(){try{this.config_data=JSON.parse(this.config_data_str),this.config_data_has_changed=!1,this.save_message_success="success",this.save_message=this.messages.configApplied,this.save_message_snack=!0}catch{this.save_message_success="error",this.save_message=this.messages.configApplyError,this.save_message_snack=!0}},createNewConfig(){j.post("/api/config/abconf/new",{name:this.configFormData.name}).then(e=>{e.data.status==="ok"?(this.save_message=e.data.message,this.save_message_snack=!0,this.save_message_success="success",this.getConfigInfoList(e.data.data.conf_id),this.cancelConfigForm()):(this.save_message=e.data.message,this.save_message_snack=!0,this.save_message_success="error")}).catch(e=>{console.error(e),this.save_message=this.tm("configManagement.createFailed"),this.save_message_snack=!0,this.save_message_success="error"})},onConfigSelect(e){e==="_%manage%_"?(this.configManageDialog=!0,this.$nextTick(()=>{this.selectedConfigID=this.selectedConfigInfo.id||"default"})):this.getConfig(e)},startCreateConfig(){this.showConfigForm=!0,this.isEditingConfig=!1,this.configFormData={name:""},this.editingConfigId=null},startEditConfig(e){this.showConfigForm=!0,this.isEditingConfig=!0,this.editingConfigId=e.id,this.configFormData={name:e.name||""}},cancelConfigForm(){this.showConfigForm=!1,this.isEditingConfig=!1,this.editingConfigId=null,this.configFormData={name:""}},saveConfigForm(){if(!this.configFormData.name){this.save_message=this.tm("configManagement.pleaseEnterName"),this.save_message_snack=!0,this.save_message_success="error";return}this.isEditingConfig?this.updateConfigInfo():this.createNewConfig()},confirmDeleteConfig(e){confirm(this.tm("configManagement.confirmDelete").replace("{name}",e.name))&&this.deleteConfig(e.id)},deleteConfig(e){j.post("/api/config/abconf/delete",{id:e}).then(s=>{s.data.status==="ok"?(this.save_message=s.data.message,this.save_message_snack=!0,this.save_message_success="success",this.cancelConfigForm(),this.getConfigInfoList("default")):(this.save_message=s.data.message,this.save_message_snack=!0,this.save_message_success="error")}).catch(s=>{console.error(s),this.save_message=this.tm("configManagement.deleteFailed"),this.save_message_snack=!0,this.save_message_success="error"})},updateConfigInfo(){j.post("/api/config/abconf/update",{id:this.editingConfigId,name:this.configFormData.name}).then(e=>{e.data.status==="ok"?(this.save_message=e.data.message,this.save_message_snack=!0,this.save_message_success="success",this.getConfigInfoList(this.editingConfigId),this.cancelConfigForm()):(this.save_message=e.data.message,this.save_message_snack=!0,this.save_message_success="error")}).catch(e=>{console.error(e),this.save_message=this.tm("configManagement.updateFailed"),this.save_message_snack=!0,this.save_message_success="error"})},onConfigTypeToggle(){this.isSystemConfig=this.configType==="system",this.fetched=!1,this.isSystemConfig?this.getConfig():this.selectedConfigID?this.getConfig(this.selectedConfigID):this.getConfigInfoList("default")},onSystemConfigToggle(){this.configType=this.isSystemConfig?"system":"normal",this.fetched=!1,this.isSystemConfig?this.getConfig():this.selectedConfigID?this.getConfig(this.selectedConfigID):this.getConfigInfoList("default")},openTestChat(){if(!this.selectedConfigID){this.save_message="è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé…ç½®æ–‡ä»¶",this.save_message_snack=!0,this.save_message_success="warning";return}this.testConfigId=this.selectedConfigID,this.testChatDrawer=!0},closeTestChat(){this.testChatDrawer=!1,this.testConfigId=null}}},jt={style:{display:"flex","flex-direction":"column","align-items":"center"}},Bt={key:0,class:"mt-4 config-panel",style:{display:"flex","flex-direction":"column","align-items":"start"}},zt={class:"d-flex flex-row pr-4",style:{"margin-bottom":"16px","align-items":"center",gap:"12px","justify-content":"space-between",width:"100%"}},Ot={class:"d-flex flex-row align-center",style:{gap:"12px"}},Nt={style:{color:"inherit"},href:"https://blog.astrbot.app/posts/what-is-changed-in-4.0.0/#%E5%A4%9A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6",target:"_blank"},Pt={style:{"margin-left":"16px"}},qt={class:"text-h4"},Kt={class:"mt-6 mb-4"},Wt={class:"d-flex align-center",style:{gap:"8px"}},Jt={key:1},Xt={class:"mb-4"},Yt={class:"d-flex justify-end mt-4",style:{gap:"8px"}},Gt={class:"test-chat-header"},Ht=d("span",{class:"text-h6"},"æµ‹è¯•é…ç½®",-1),Qt={key:0,class:"text-caption text-grey"},Zt={class:"test-chat-content"};function Mt(e,s,h,o,i,g){const T=X("AstrBotCoreConfigWrapper"),w=X("VueMonacoEditor"),E=X("WaitingForRestart"),D=X("StandaloneChat");return l(),v(U,null,[d("div",jt,[i.selectedConfigID||i.isSystemConfig?(l(),v("div",Bt,[d("div",zt,[d("div",Ot,[i.isSystemConfig?b("",!0):(l(),S(Xe,{key:0,style:{"min-width":"130px"},modelValue:i.selectedConfigID,"onUpdate:modelValue":[s[0]||(s[0]=r=>i.selectedConfigID=r),g.onConfigSelect],items:g.configSelectItems,"item-title":"name",disabled:h.initialConfigId!==null,"item-value":"id",label:o.tm("configSelection.selectConfig"),"hide-details":"",density:"compact",rounded:"md",variant:"outlined"},null,8,["modelValue","items","disabled","label","onUpdate:modelValue"])),d("a",Nt,[t(I,{icon:"mdi-help-circle",size:"small",variant:"plain"})])]),t(Ye,{modelValue:i.configType,"onUpdate:modelValue":[s[1]||(s[1]=r=>i.configType=r),g.onConfigTypeToggle],mandatory:"",color:"primary",variant:"outlined",density:"comfortable",rounded:"md"},{default:a(()=>[t(I,{value:"normal","prepend-icon":"mdi-cog",size:"large"},{default:a(()=>[_(c(o.tm("configSelection.normalConfig")),1)]),_:1}),t(I,{value:"system","prepend-icon":"mdi-cog-outline",size:"large"},{default:a(()=>[_(c(o.tm("configSelection.systemConfig")),1)]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),t(Ge,{mode:"out-in"},{default:a(()=>[(i.selectedConfigID||i.isSystemConfig)&&i.fetched?(l(),v("div",{key:i.configContentKey,class:"config-content",style:{width:"100%"}},[t(T,{metadata:i.metadata,config_data:i.config_data},null,8,["metadata","config_data"]),t(te,{text:o.tm("actions.save"),location:"left"},{activator:a(({props:r})=>[t(I,se(r,{icon:"mdi-content-save",size:"x-large",style:{position:"fixed",right:"52px",bottom:"52px"},color:"darkprimary",onClick:g.updateConfig}),null,16,["onClick"])]),_:1},8,["text"]),t(te,{text:o.tm("codeEditor.title"),location:"left"},{activator:a(({props:r})=>[t(I,se(r,{icon:"mdi-code-json",size:"x-large",style:{position:"fixed",right:"52px",bottom:"124px"},color:"primary",onClick:s[2]||(s[2]=V=>{g.configToString(),i.codeEditorDialog=!0})}),null,16)]),_:1},8,["text"]),i.isSystemConfig?b("",!0):(l(),S(te,{key:0,text:"æµ‹è¯•å½“å‰é…ç½®",location:"left"},{activator:a(({props:r})=>[t(I,se(r,{icon:"mdi-chat-processing",size:"x-large",style:{position:"fixed",right:"52px",bottom:"196px"},color:"secondary",onClick:g.openTestChat}),null,16,["onClick"])]),_:1}))])):b("",!0)]),_:1})])):b("",!0)]),t(G,{modelValue:i.codeEditorDialog,"onUpdate:modelValue":s[7]||(s[7]=r=>i.codeEditorDialog=r),fullscreen:"",transition:"dialog-bottom-transition",scrollable:""},{default:a(()=>[t(z,null,{default:a(()=>[t(ue,{color:"primary",dark:""},{default:a(()=>[t(I,{icon:"",onClick:s[3]||(s[3]=r=>i.codeEditorDialog=!1)},{default:a(()=>[t(ne,null,{default:a(()=>[_("mdi-close")]),_:1})]),_:1}),t(me,null,{default:a(()=>[_(c(o.tm("codeEditor.title")),1)]),_:1}),t(he),t(_e,{style:{display:"flex","align-items":"center"}},{default:a(()=>[t(I,{style:{"margin-left":"16px"},size:"small",onClick:s[4]||(s[4]=r=>g.configToString())},{default:a(()=>[_(c(o.tm("editor.revertCode")),1)]),_:1}),i.config_data_has_changed?(l(),S(I,{key:0,style:{"margin-left":"16px"},size:"small",onClick:s[5]||(s[5]=r=>g.applyStrConfig())},{default:a(()=>[_(c(o.tm("editor.applyConfig")),1)]),_:1})):b("",!0),d("small",Pt,"ðŸ’¡ "+c(o.tm("editor.applyTip")),1)]),_:1})]),_:1}),t(q,{class:"pa-0"},{default:a(()=>[t(w,{language:"json",theme:"vs-dark",style:{height:"calc(100vh - 64px)"},value:i.config_data_str,"onUpdate:value":s[6]||(s[6]=r=>i.config_data_str=r)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(G,{modelValue:i.configManageDialog,"onUpdate:modelValue":s[10]||(s[10]=r=>i.configManageDialog=r),"max-width":"800px"},{default:a(()=>[t(z,null,{default:a(()=>[t(Ce,{class:"d-flex align-center justify-space-between"},{default:a(()=>[d("span",qt,c(o.tm("configManagement.title")),1),t(I,{icon:"mdi-close",variant:"text",onClick:s[8]||(s[8]=r=>i.configManageDialog=!1)})]),_:1}),t(q,null,{default:a(()=>[d("small",null,c(o.tm("configManagement.description")),1),d("div",Kt,[t(I,{"prepend-icon":"mdi-plus",onClick:g.startCreateConfig,variant:"tonal",color:"primary"},{default:a(()=>[_(c(o.tm("configManagement.newConfig")),1)]),_:1},8,["onClick"])]),t(Ze,{lines:"two"},{default:a(()=>[(l(!0),v(U,null,P(i.configInfoList,r=>(l(),S(fe,{key:r.id,title:r.name},Me({_:2},[r.id!=="default"?{name:"append",fn:a(()=>[d("div",Wt,[t(I,{icon:"mdi-pencil",size:"small",variant:"text",color:"warning",onClick:V=>g.startEditConfig(r)},null,8,["onClick"]),t(I,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:V=>g.confirmDeleteConfig(r)},null,8,["onClick"])])]),key:"0"}:void 0]),1032,["title"]))),128))]),_:1}),i.showConfigForm?(l(),S(ae,{key:0,class:"my-6"})):b("",!0),i.showConfigForm?(l(),v("div",Jt,[d("h3",Xt,c(i.isEditingConfig?o.tm("configManagement.editConfig"):o.tm("configManagement.newConfig")),1),d("h4",null,c(o.tm("configManagement.configName")),1),t($e,{modelValue:i.configFormData.name,"onUpdate:modelValue":s[9]||(s[9]=r=>i.configFormData.name=r),label:o.tm("configManagement.fillConfigName"),variant:"outlined",class:"mt-4 mb-4","hide-details":""},null,8,["modelValue","label"]),d("div",Yt,[t(I,{variant:"text",onClick:g.cancelConfigForm},{default:a(()=>[_(c(o.tm("buttons.cancel")),1)]),_:1},8,["onClick"]),t(I,{color:"primary",onClick:g.saveConfigForm,disabled:!i.configFormData.name},{default:a(()=>[_(c(i.isEditingConfig?o.tm("buttons.update"):o.tm("buttons.create")),1)]),_:1},8,["onClick","disabled"])])])):b("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(He,{timeout:3e3,elevation:"24",color:i.save_message_success,modelValue:i.save_message_snack,"onUpdate:modelValue":s[11]||(s[11]=r=>i.save_message_snack=r)},{default:a(()=>[_(c(i.save_message),1)]),_:1},8,["color","modelValue"]),t(E,{ref:"wfr"},null,512),t(Qe,{modelValue:i.testChatDrawer,"onUpdate:modelValue":s[12]||(s[12]=r=>i.testChatDrawer=r),class:"test-chat-overlay",location:"right",transition:"slide-x-reverse-transition",scrim:!0,"onClick:outside":g.closeTestChat},{default:a(()=>[t(z,{class:"test-chat-card",elevation:"12"},{default:a(()=>[d("div",Gt,[d("div",null,[Ht,g.selectedConfigInfo.name?(l(),v("div",Qt,c(g.selectedConfigInfo.name)+" ("+c(i.testConfigId)+") ",1)):b("",!0)]),t(I,{icon:"",variant:"text",onClick:g.closeTestChat},{default:a(()=>[t(ne,null,{default:a(()=>[_("mdi-close")]),_:1})]),_:1},8,["onClick"])]),t(ae),d("div",Zt,[i.testChatDrawer?(l(),S(D,{key:0,configId:i.testConfigId},null,8,["configId"])):b("",!0)])]),_:1})]),_:1},8,["modelValue","onClick:outside"])],64)}const $t=H(Rt,[["render",Mt]]),cs=Object.freeze(Object.defineProperty({__proto__:null,default:$t},Symbol.toStringTag,{value:"Module"}));export{Vt as A,$t as C,cs as a};

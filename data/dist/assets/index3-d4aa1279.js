import{T as R,v as p,x as b,M,aQ as B,o as x,g as E,b as C,w as I,A as T,p as O,aX as A,n as K}from"./index-61371d60.js";import{t as N,K as V,c as L,a as D,s as H,n as P}from"./github-9f73710c.js";var g=(d,n,r)=>new Promise((a,s)=>{var v=o=>{try{t(r.next(o))}catch(e){s(e)}},i=o=>{try{t(r.throw(o))}catch(e){s(e)}},t=o=>o.done?a(o.value):Promise.resolve(o.value).then(v,i);t((r=r.apply(d,n)).next())});const S={key:0,class:"math-loading-overlay"},w=N(R({__name:"MathBlockNode",props:{node:{}},setup(d){const n=d,r=p(null),a=p(null);let s=!1,v=0,i=!1,t=null;const o=V();let e=null;const u=p(!0);function y(){return g(this,null,function*(){if(!n.node.content||!a.value||i)return;if(!s)try{!e&&r.value&&(e=o(r.value)),yield e==null?void 0:e.whenVisible}catch{}t&&(t.abort(),t=null);const c=++v,m=new AbortController;t=m,L(n.node.content,!0,{timeout:3e3,waitTimeout:2e3,maxRetries:1,signal:m.signal}).then(l=>{i||c!==v||a.value&&(a.value.innerHTML=l,s=!0,u.value=!1)}).catch(l=>g(null,null,function*(){if(i||c!==v||!a.value)return;const f=(l==null?void 0:l.code)||(l==null?void 0:l.name),k=f==="KATEX_DISABLED";if(f==="WORKER_INIT_ERROR"||l!=null&&l.fallbackToRenderer||f===D||f==="WORKER_TIMEOUT"){const _=yield H();if(_){try{const h=_.renderToString(n.node.content,{throwOnError:n.node.loading,displayMode:!0});a.value.innerHTML=h,s=!0,u.value=!1,P(n.node.content,!0,h)}catch{}return}}if(k)return u.value=!1,void(a.value.textContent=n.node.raw);s||(u.value=!0),n.node.loading||(u.value=!1,a.value.textContent=n.node.raw)}))})}return b(()=>n.node.content,()=>{y()}),M(()=>{y()}),B(()=>{var c;i=!0,t&&(t.abort(),t=null),(c=e==null?void 0:e.destroy)==null||c.call(e),e=null}),(c,m)=>(x(),E("div",{ref_key:"containerEl",ref:r,class:"math-block text-center overflow-x-auto relative min-h-[40px]"},[C(A,{name:"math-fade"},{default:I(()=>[u.value?(x(),E("div",S,[...m[0]||(m[0]=[T("div",{class:"math-loading-spinner"},null,-1)])])):O("",!0)]),_:1}),T("div",{ref_key:"mathBlockElement",ref:a,class:K({"math-rendering":u.value})},null,2)],512))}}),[["__scopeId","data-v-dab27d4f"]]);w.install=d=>{d.component(w.__name,w)};export{w as default};
